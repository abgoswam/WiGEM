cscope 15 $HOME/Desktop/2.PaperWriteup/Figs4Paper/CEWIT/GMM-LogLikelihood/GMM_learn_test -q 0000000517 0000086458
	@include/eval.h

49 #iâdeà
__ev®_h__


50 
	#__ev®_h__


	)

53 
	~<¡ršg.h
>

54 
	~<io¡»am
>

55 
	~<iomª
>

56 
usšg
 
Çme¥aû
 
	g¡d
;

58 
	#MAX_AP
 80

	)

59 
	#MAX_LOCATIONS
 600

	)

60 
	#MAX_OBSERVATIONS
 55000

	)

61 
	#MAX_SNIFFERS
 9

	)

63 
	#NUM_SNIFFERS
 6

	)

64 
	#NUM_LOCATIONS
 267

	)

66 
	#NUM_POWER_LEVELS
 31

	)

67 
	#MID_POINT_POWER_LEVEL
 15

	)

69 
	#RATE_OF_INCREASE
 1.0

	)

70 
	#STD_DEVIATION
 2

	)

71 
	#MAX_CONVERGE
 200

	)

73 
	#TIME_DIVISIONS
 72

	)

75 
	#NUM_OBSERVATIONS
 0

	)

77 
	#·nic
(
a
...èdØ{ 
	`årštf
(
¡d”r
,‡); f´štf(¡d”r, "\n"); 
	`ex™
(1); } 0)

	)

79 şas 
	cBSSID
 {

80 
	m´iv©e
:

81 
où‘
[6];

83 
	mpublic
:

84 
BSSID
(cÚ¡ *
‹xtu®
);

85 
boŞ
 
equ®s
(
BSSID
 *
Ùh”
);

86 
boŞ
 
equ®s
(cÚ¡ *
‹xtu®
);

87 *
»nd”
(*
buf
);

90 şas 
	cacûssPoštRecÜd
 {

91 
	m´iv©e
:

92 
BSSID
 *
bssid
;

93 
	messid
[32];

95 
	mpublic
:

96 
acûssPoštRecÜd
(cÚ¡ *
bssidTextu®
, cÚ¡ *
essid
);

97 
boŞ
 
equ®s
(cÚ¡ *
bssidTextu®
, cÚ¡ *
essid
);

98 
boŞ
 
essid_equ®s
(cÚ¡ *
essid
);

99 
BSSID
 *
g‘BSSID
();

100 cÚ¡ *
g‘SSID
();

101 
dump
();

102 
acûssPoštRecÜd
 *
şÚe
();

105 şas 
	cloÿtiÚRecÜd
 {

106 
	m´iv©e
:

107 
desütiÚ
[50];

108 
	mx
, 
	my
, 
	mz
;

109 
	mssi_152
, 
	mssi_153
, 
	mssi_154
, 
	mssi_156
, 
	mssi_157
, 
	mssi_160
;

111 
	mpublic
:

112 
loÿtiÚRecÜd
(cÚ¡ *
desütiÚ
, 
x
, 
y
, 
z
, 
ssi_152
, 
ssi_153
, 
ssi_154
, 
ssi_156
, 
ssi_157
, 
ssi_160
);

113 
loÿtiÚRecÜd
(cÚ¡ *
desütiÚ
, 
x
, 
y
, 
z
);

114 
boŞ
 
loÿtiÚ_Çme_equ®s
(cÚ¡ *
desütiÚ
);

115 
boŞ
 
equ®s
(cÚ¡ *
desütiÚ
, 
x
, 
y
, 
z
);

116 
boŞ
 
desütiÚEqu®s
(cÚ¡ *
desütiÚ
);

117 
boŞ
 
equ®s
(
loÿtiÚRecÜd
 *
Ùh”
);

118 
boŞ
 
isAt
(
x
, 
y
, 
z
);

119 
dump
();

120 *
»nd”
(*
buf
);

121 
di¡ªûTo
(
loÿtiÚRecÜd
 *
Ùh”
);

122 
di¡ªûTo
(
x
, 
y
, 
z
);

123 
g‘X
();

124 
g‘Y
();

125 
g‘Z
();

126 
g‘152
();

127 
g‘153
();

128 
g‘154
();

129 
g‘156
();

130 
g‘157
();

131 
g‘160
();

132 
loÿtiÚRecÜd
 *
şÚe
();

135 şas 
	csûÇrioDesütÜ
 {

136 
	m´iv©e
:

137 cÚ¡ 
maxAP
 = 
MAX_AP
;

138 cÚ¡ 
	mmaxLoÿtiÚs
 = 
MAX_LOCATIONS
;

140 
acûssPoštRecÜd
 *
	m­
[
maxAP
];

141 
loÿtiÚRecÜd
 *
	mloÿtiÚ
[
maxLoÿtiÚs
];

142 
	mnumAP
, 
	mnumLoÿtiÚs
;

143 
boŞ
 
	misLocked
;

145 
	mpublic
:

147 
š™_sigÇl
[
NUM_SNIFFERS
][
NUM_LOCATIONS
];

148 
sûÇrioDesütÜ
();

149 
sûÇrioDesütÜ
(cÚ¡ *
¶aûFe
, cÚ¡ *
­Fe
 = 
NULL
);

150 
g‘LoÿtiÚIndex
(cÚ¡ *
loÿtiÚName
, 
xPos
, 
yPos
, 
zPos
);

151 
g‘LoùnIndex
(cÚ¡ *
loÿtiÚName
);

152 
ju¡g‘LoÿtiÚIndex
(
xPos
, 
yPos
, 
zPos
);

153 
g‘LoÿtiÚIndex
(
loÿtiÚRecÜd
 *
loc
);

154 
g‘LoÿtiÚIndex
(cÚ¡ *
loÿtiÚName
);

155 
g‘ApIndex
(cÚ¡ *
bssid
, cÚ¡ *
essid
 = 
NULL
);

156 
g‘SnifãrIndex
(cÚ¡ *
essid
);

157 
loÿtiÚRecÜd
 *
g‘LoÿtiÚ
(
šdex
);

158 
loÿtiÚRecÜd
 *
fšdLoÿtiÚ
(
x
, 
y
, 
z
);

159 
g‘NumLoÿtiÚs
();

160 
g‘NumAP
();

161 
acûssPoštRecÜd
 *
g‘AP
(
šdex
);

162 
dump
();

163 
lock
();

164 
sûÇrioDesütÜ
 *
şÚe
();

165 
»moveAP
(
­Index
);

168 şas 
	c´obab™yVeùÜ
 {

169 
	m´iv©e
:

170 cÚ¡ 
maxLoÿtiÚs
 = 
MAX_LOCATIONS
;

172 
	mpublic
:

173 
pLoÿtiÚ
[
maxLoÿtiÚs
];

175 
´obab™yVeùÜ
();

176 
£tAÎ
(
p
);

177 
£t
(
šdex
, 
p
);

178 
£tRªge
(
begš
, 
’d
, 
p
);

179 
be¡LoÿtiÚIndex
();

180 
NNSS_be¡LoÿtiÚIndex
();

183 şas 
	cob£rv©iÚRecÜd
 {

184 
	mpublic
:

186 
sœ
[
MAX_AP
];

187 
	m¢r
[
MAX_AP
];

189 
ob£rv©iÚRecÜd
();

190 
euşid—nDi¡ªûSqProj
(
ob£rv©iÚRecÜd
 *
Ùh”
);

191 
euşid—nDi¡ªûSq
(
ob£rv©iÚRecÜd
 *
Ùh”
);

192 
euşid—nDi¡ªûSqLoc
(
loÿtiÚRecÜd
 *
LOC
);

193 
add
(
ob£rv©iÚRecÜd
 *
Ùh”
);

194 
divideBy
(
divisÜ
);

195 
z”o
();

196 
boŞ
 
isV®id
();

197 
dump
();

198 
£tTo
(
sœ
, 
¢r
);

199 
adju¡Max
(
ob£rv©iÚRecÜd
 *
Ùh”
);

200 
adju¡Mš
(
ob£rv©iÚRecÜd
 *
Ùh”
);

201 
­¶yCÜ»ùive
(
a
, 
b
, 
c
);

202 
boŞ
 
di¡šùFrom
(
ob£rv©iÚRecÜd
 *
Ùh”
);

203 
numVisibËAPs
();

204 
»moveAP
(
­Index
);

207 şas 
	cŒaššgD©aPackage
 {

208 
	m´iv©e
:

209 cÚ¡ 
maxOb£rv©iÚs
 = 
MAX_OBSERVATIONS
;

211 
	mpublic
:

212 
ob£rv©iÚRecÜd
 
ob£rv©iÚ
[
maxOb£rv©iÚs
];

213 
	mloÿtiÚIndex
[
maxOb£rv©iÚs
];

214 
sûÇrioDesütÜ
 *
	msûÇrio
;

215 
	mnumOb£rv©iÚs
;

217 
ŒaššgD©aPackage
();

218 
ŒaššgD©aPackage
(cÚ¡ *
¶aûFeName
, cÚ¡ *
­FeName
 = 
NULL
);

219 
addFe
(cÚ¡ *
feName
);

220 
sw­Ob£rv©iÚs
(
i
, 
j
);

221 
dump
();

222 
boŞ
 
»adNewFe
(cÚ¡ *
feName
);

223 
boŞ
 
»adFe
(cÚ¡ *
feName
, 
ob£rv©iÚRecÜd
 *
o
, *
loÿtiÚ
);

224 
addT¿ššgDœeùÜy
(cÚ¡ *
dœeùÜyName
);

225 
addDœeùÜy
(cÚ¡ *
dœeùÜyName
);

226 
tsh¬k_·r£Fe
(cÚ¡ *
feName
, cÚ¡ *
out_fe
 );

227 
·tchIncom¶‘eOb£rv©iÚs
();

228 
­¶yCÜ»ùive
(
a
, 
b
, 
c
);

229 
numOb£rv©iÚsAtLoÿtiÚ
(
šdex
);

230 
loÿtiÚRecÜd
 *
fšdAP
(
­Index
);

231 
ob£rv©iÚRecÜd
 
»moveOb£rv©iÚ
(
šdex
);

232 
fœ¡Ob£rv©iÚAt
(
šdex
);

233 
ŒaššgD©aPackage
 *
şÚe
();

234 
wr™eOb£rv©iÚsTo
(cÚ¡ *
feName
);

235 
»adOb£rv©iÚsFrom
(cÚ¡ *
feName
, 
M
);

236 
addOb£rv©iÚ
(
ob£rv©iÚRecÜd
 
o
, 
loÿtiÚIndex
);

237 
lim™Ob£rv©iÚsP”LoÿtiÚ
(
lim™
);

238 
»moveAP
(
­Index
);

241 şas 
	cLoÿliz”
 {

242 
	mpublic
:

243 
	$Loÿliz”
() {};

244 
vœtu®
 
	$loÿlize
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
´obab™yVeùÜ
 *
v
è{
	}
};

247 şas 
	cGMMLoÿliz”
 : 
public
 
Loÿliz”
 {

248 
´iv©e
:

249 
m
;

250 
	mp
[
NUM_LOCATIONS
];

251 
	mq
[
NUM_POWER_LEVELS
];

253 
	mmu
[
NUM_SNIFFERS
][
NUM_LOCATIONS
][
NUM_POWER_LEVELS
];

254 
	msigma
[
NUM_SNIFFERS
][
NUM_LOCATIONS
][
NUM_POWER_LEVELS
];

256 
	mpublic
:

257 
GMMLoÿliz”
Ğ
ŒaššgD©aPackage
 *
d©a
);

258 
Ex³ù©iÚMaximiz©iÚ
(
ŒaššgD©aPackage
 *
d©a
);

259 
log_p_v®ue
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
j
, 
k
);

260 
p_v®ue
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
j
, 
k
);

261 
vœtu®
 
loÿlize
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
´obab™yVeùÜ
 *
v
);

264 şas 
	cMaximumLik–ihoodLoÿliz”
 : 
public
 
Loÿliz”
 {

265 
´iv©e
:

266 cÚ¡ 
maxLoÿtiÚs
 = 
MAX_LOCATIONS
;

267 cÚ¡ 
	mmaxAP
 = 
MAX_AP
;

268 
	msigma
[
maxLoÿtiÚs
][
maxAP
], 
	mmu
[maxLocations][maxAP];

269 
	msigma2
[
maxLoÿtiÚs
][
maxAP
][maxAP], 
	mmu2
[maxLocations][maxAP][maxAP];

270 
boŞ
 
	mgoodAP
[
maxLoÿtiÚs
][
maxAP
];

271 
sûÇrioDesütÜ
 *
	msûÇrio
;

272 
	mwdÿrds
;

273 
	mNumSnifãrs
;

275 
	mpublic
:

276 
MaximumLik–ihoodLoÿliz”
(
ŒaššgD©aPackage
 *
d©a
, 
wdÿrds
);

277 
MaximumLik–ihoodLoÿliz”
(
sûÇrioDesütÜ
 *
sûÇrio
, cÚ¡ *
mlFeName
, 
wdÿrds
);

278 
vœtu®
 
loÿlize
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
´obab™yVeùÜ
 *
v
);

279 
g‘Sigma
(
loÿtiÚIndex
, 
­Index
);

280 
g‘Mu
(
loÿtiÚIndex
, 
­Index
);

281 
boŞ
 
isGoodAP
(
loÿtiÚIndex
, 
­Index
);

282 
upd©eRawProbab™›s
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
´obab™yVeùÜ
 *
v
);

285 şas 
	cBayesŸnLoÿliz”
 : 
public
 
Loÿliz”
 {

286 
´iv©e
:

287 cÚ¡ 
maxLoÿtiÚs
 = 
MAX_LOCATIONS
;

288 cÚ¡ 
	mmaxAP
 = 
MAX_AP
;

289 
ŒaššgD©aPackage
 *
	mŒaššgD©a
;

290 
	mp
[
maxLoÿtiÚs
][
maxAP
][256];

291 
	mwdÿrds
;

293 
	mpublic
:

294 
BayesŸnLoÿliz”
(
ŒaššgD©aPackage
 *
d©a
, 
wdÿrds
);

295 
vœtu®
 
loÿlize
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
´obab™yVeùÜ
 *
v
);

296 
g‘RawProbab™›s
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
´obab™yVeùÜ
 *
v
);

299 şas 
	cSti¡ics
 {

300 
	m´iv©e
:

301 cÚ¡ 
g¿nuÏr™y
 = 10;

302 
boŞ
 
	msÜ‹d
;

303 *
	md©a
;

304 
	mnumV®ues
;

305 
	mmaxV®ues
;

307 
sÜt
();

309 
	mpublic
:

310 
Sti¡ics
();

311 
addV®ue
(
v®ue
);

312 
äaùiÚSm®ËrThª
(
x
);

313 
numSm®ËrThª
(
x
);

314 
äaùiÚB‘w“n
(
x
, 
y
);

315 
numB‘w“n
(
x
, 
y
);

316 
numTÙ®
();

317 
³rûÁe
(
n
);

318 
av”age
();

319 
mšimum
();

320 
maximum
();

323 şas 
	cTİŞogyMod–
 {

324 
	m´iv©e
:

325 cÚ¡ 
maxLoÿtiÚs
 = 
MAX_LOCATIONS
;

326 cÚ¡ 
	mmaxNeighbours
 = 10;

327 cÚ¡ 
	mmaxInSameRoom
 = 10;

329 
	mÃighbour
[
maxLoÿtiÚs
][
maxNeighbours
];

330 
	m§meRoom
[
maxLoÿtiÚs
][
maxInSameRoom
];

331 
	mnumNeighbours
[
maxLoÿtiÚs
];

332 
	mnumInSameRoom
[
maxLoÿtiÚs
];

333 
sûÇrioDesütÜ
 *
	msûÇrio
;

335 
	mpublic
:

336 
TİŞogyMod–
(
sûÇrioDesütÜ
 *
sûÇrio
, cÚ¡ *
ÃighbourFe
, cÚ¡ *
§meRoomFe
 = 
NULL
);

337 
g‘NumNeighbours
(
loÿtiÚIndex
);

338 
g‘Neighbour
(
loÿtiÚIndex
, 
ÃighbourIndex
);

339 
addNeighbour
(
loÿtiÚIndex
, 
ÃighbourIndex
);

340 
wr™eTo
(cÚ¡ *
ÃighbourFe
);

341 
boŞ
 
isNeighbourOf
(
loÿtiÚA
, 
loÿtiÚB
);

342 
boŞ
 
šSameRoom
(
loÿtiÚA
, 
loÿtiÚB
);

345 şas 
	cHidd’M¬kovMod–
 {

346 
	m´iv©e
:

347 cÚ¡ 
maxLoÿtiÚs
 = 
MAX_LOCATIONS
;

348 
TİŞogyMod–
 *
	mmod–
;

350 
	mpublic
:

351 
Hidd’M¬kovMod–
(
TİŞogyMod–
 *
mod–
);

352 
upd©e
(
´obab™yVeùÜ
 *
v
);

	@librwl/accesspoint.cc

49 
	~<¡dio.h
>

50 
	~<¡ršg.h
>

52 
	~"ev®.h
"

54 
	gacûssPoštRecÜd
::
	$acûssPoštRecÜd
(cÚ¡ *
bssidTextu®
, cÚ¡ *
essid
)

56 
this
->
bssid
 = 
Ãw
 
	`BSSID
(
bssidTextu®
);

57 
	`¡ºıy
(
this
->
essid
,ƒssid, (this->essid));

58 
this
->
essid
[(this->essid)-1] = 0;

59 
	}
}

61 
	gacûssPoštRecÜd
::
	$dump
()

63 
bssidBuf
[20];

64 
	`´štf
("% %s\n", 
bssid
->
	`»nd”
(
bssidBuf
), 
essid
);

65 
	}
}

67 
boŞ
 
	gacûssPoštRecÜd
::
	$equ®s
(cÚ¡ *
bssidTextu®
, cÚ¡ *
essid
)

69  (
bssid
->
	`equ®s
(
bssidTextu®
è&& (!
essid
 || !
	`¡rcmp
(
this
->essid,ƒssid)));

70 
	}
}

72 
boŞ
 
	gacûssPoštRecÜd
::
	$essid_equ®s
(cÚ¡ *
essid
)

74  (!
essid
 || !
	`¡rcmp
(
this
->essid,ƒssid));

75 
	}
}

77 
BSSID
 *
	gacûssPoštRecÜd
::
	$g‘BSSID
()

79  
bssid
;

80 
	}
}

82 
acûssPoštRecÜd
 *
	gacûssPoštRecÜd
::
	$şÚe
()

84 
s
[256];

86  
Ãw
 
	`acûssPoštRecÜd
(
bssid
->
	`»nd”
(
s
), 
essid
);

87 
	}
}

89 cÚ¡ *
	gacûssPoštRecÜd
::
	$g‘SSID
()

91  
essid
;

92 
	}
}

	@librwl/bayes.cc

49 
	~<¡dlib.h
>

50 
	~<¡dio.h
>

51 
	~<¡ršg.h
>

52 
	~<m©h.h
>

53 
	~<as£¹.h
>

54 
	~"ev®.h
"

57 
	#d´štf
(
a
...)

	)

61 cÚ¡ 
	g©ŠL’gth
 = 5;

62 cÚ¡ 
	g©ŠC’‹r
 = 2;

63 
	g©Š
[9] = { 1.0/16, 4.0/16, 6.0/16, 4.0/16, 1.0/16 };

65 
	$dumpSÜ‹d
(*
pCÚd
, 
ŒaššgD©aPackage
 *
d©a
)

67 
low”
 = 1.0, 
uµ”
 = 1.1;

68 
couÁ
 = 0;

69 
buf1
[256];

73 
uµ”
 > 0.0005) {

74 
mx
 = 0;

75 
i
=0; i<
d©a
->
sûÇrio
->
	`g‘NumLoÿtiÚs
(); i++) {

76 ià((
pCÚd
[
i
] >ğ
low”
è&& (pCÚd[i] < 
uµ”
)) {

77 
	`´štf
("%.4f: %s\n", 
pCÚd
[
i
], 
d©a
->
sûÇrio
->
	`g‘LoÿtiÚ
(i)->
	`»nd”
(
buf1
));

78 ià((++
couÁ
) == 10)

81 ià((
pCÚd
[
i
] < 
low”
è&& (pCÚd[i] > 
mx
))

82 
mx
 = 
pCÚd
[
i
];

84 
uµ”
 = 
low”
;

85 
low”
 = 
mx
;

87 
	}
}

89 
	gBayesŸnLoÿliz”
::
	$BayesŸnLoÿliz”
(
ŒaššgD©aPackage
 *
d©a
, 
wdÿrds
)

91 
this
->
ŒaššgD©a
 = 
d©a
;

92 
this
->
wdÿrds
 = wildcards;

96 
i
=0; i<
MAX_LOCATIONS
; i++)

97 
j
=0; j<
MAX_AP
; j++)

98 
k
=0; k<256; k++)

99 
p
[
i
][
j
][
k
] = 0;

101 
i
=0; i<
d©a
->
numOb£rv©iÚs
; i++)

102 
j
=0; j<
d©a
->
sûÇrio
->
	`g‘NumAP
(); j++)

103 
p
[
d©a
->
loÿtiÚIndex
[
i
]][
j
][d©a->
ob£rv©iÚ
[i].
sœ
[j]] += 1.0;

105 
i
=0; i<
d©a
->
sûÇrio
->
	`g‘NumLoÿtiÚs
(); i++) {

106 
j
=0; j<
MAX_AP
; j++) {

110 
tÙ®
 = 0;

111 
k
=1; k<256; k++)

112 
tÙ®
 +ğ
p
[
i
][
j
][
k
];

113 ià(
tÙ®
>0.5) {

114 
k
=1; k<256; k++) {

115 
p
[
i
][
j
][
k
] /ğ
tÙ®
;

121 
ÃwP
[256];

122 
k
=0; k<256; k++)

123 
ÃwP
[
k
] = 0;

125 
k
=1; k<256; k++) {

126 
l
=0;†<
©ŠL’gth
;†++) {

127 
idx
 = 
k
+
l
-
©ŠC’‹r
;

128 ià(
idx
 < 0)

129 
idx
 = 0;

130 ià(
idx
 > 255)

131 
idx
 = 255;

132 
ÃwP
[
idx
] +ğ
p
[
i
][
j
][
k
]*
©Š
[
l
];

138 ià(
tÙ®
 > 0.5) {

139 
k
=0; k<256; k++) {

140 
p
[
i
][
j
][
k
] = 
ÃwP
[k];

145 
	}
}

151 
	gBayesŸnLoÿliz”
::
	$loÿlize
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
´obab™yVeùÜ
 *
v
)

153 
numVisibËAP
 = 0;

154 
i
=0; i<
ŒaššgD©a
->
sûÇrio
->
	`g‘NumAP
(); i++)

155 ià(
ob£rv©iÚ
->
sœ
[
i
]>0)

156 
numVisibËAP
 ++;

158 ià(!
numVisibËAP
)

159 
	`·nic
("No APs visible");

161 
numWdÿrds
 = ()(
numVisibËAP
 * 
wdÿrds
 + 0.5);

162 
	`as£¹
((
numWdÿrds
 < 
MAX_AP
è&& (numWdÿrds<
numVisibËAP
));

166 
PtÙ®
 = 0;

168 
i
=0; i<
ŒaššgD©a
->
sûÇrio
->
	`g‘NumLoÿtiÚs
(); i++) {

169 
Pmš
[
MAX_AP
];

171 
q
=0; q<
numWdÿrds
; q++)

172 
Pmš
[
q
] = 1.0;

174 
buf
[256];

175 
	`d´štf
("+++ LoÿtiÚ upd©fÜ (%dè%s\n", 
i
, 
ŒaššgD©a
->
sûÇrio
->
	`g‘LoÿtiÚ
(i)->
	`»nd”
(
buf
));

181 
j
=0; j<
ŒaššgD©a
->
sûÇrio
->
	`g‘NumAP
(); j++) {

182 ià(
ob£rv©iÚ
->
sœ
[
j
]) {

183 
çùÜ
 = 
p
[
i
][
j
][
ob£rv©iÚ
->
sœ
[j]];

188 ià(
çùÜ
<0.00001)

189 
çùÜ
 = 0.00001;

191 
	`d´štf
("AP#%2d: % SIR=%3d faùÜ=%.8f\n", 
j
, 
ŒaššgD©a
->
sûÇrio
->
	`g‘AP
(j)->
	`g‘BSSID
()->
	`»nd”
(
buf
), 
ob£rv©iÚ
->
sœ
[j], 
çùÜ
);

193 
v
->
pLoÿtiÚ
[
i
] *ğ
çùÜ
;

197 
r
=0;„<
numWdÿrds
;„++) {

198 ià(
çùÜ
 < 
Pmš
[
r
]) {

199 
s
=
numWdÿrds
-2; s>=
r
; s--)

200 
Pmš
[
s
+1] = Pmin[s];

202 
Pmš
[
r
] = 
çùÜ
;

211 
	`as£¹
(
Pmš
>0);

212 
q
=0; q<
numWdÿrds
; q++) {

213 
v
->
pLoÿtiÚ
[
i
] /ğ
Pmš
[
q
];

214 
	`d´štf
("Wdÿrd: %.8f\n", 
Pmš
[
q
]);

217 
PtÙ®
 +ğ
v
->
pLoÿtiÚ
[
i
];

222 
i
=0; i<
ŒaššgD©a
->
sûÇrio
->
	`g‘NumLoÿtiÚs
(); i++) {

223 
v
->
pLoÿtiÚ
[
i
] /ğ
PtÙ®
;

225 
	}
}

227 
	gBayesŸnLoÿliz”
::
	$g‘RawProbab™›s
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
´obab™yVeùÜ
 *
v
)

229 
i
=0; i<
ŒaššgD©a
->
sûÇrio
->
	`g‘NumLoÿtiÚs
(); i++) {

230 
loÿtiÚFaùÜ
 = 1.0;

232 
j
=0; j<
ŒaššgD©a
->
sûÇrio
->
	`g‘NumAP
(); j++) {

233 ià(
ob£rv©iÚ
->
sœ
[
j
] > 0) {

234 
çùÜ
 = 
p
[
i
][
j
][
ob£rv©iÚ
->
sœ
[j]];

236 ià(
çùÜ
<0.00001)

237 
çùÜ
 = 0.00001;

239 
loÿtiÚFaùÜ
 *ğ
çùÜ
;

243 
v
->
pLoÿtiÚ
[
i
] = 
loÿtiÚFaùÜ
;

246 
i
=
ŒaššgD©a
->
sûÇrio
->
	`g‘NumLoÿtiÚs
(); i<
maxLoÿtiÚs
; i++)

247 
v
->
pLoÿtiÚ
[
i
] = 0;

248 
	}
}

	@librwl/bssid.cc

49 
	~<¡dlib.h
>

50 
	~<¡ršg.h
>

51 
	~<¡dio.h
>

53 
	~"ev®.h
"

55 
	gBSSID
::
	$BSSID
(cÚ¡ *
‹xtu®
)

57 
bufãr
[18];

59 
	`¡ºıy
(
bufãr
, 
‹xtu®
, 17);

60 
bufãr
[17] = 0;

62 
i
=0; i<6; i++) {

63 *
¡r
 = 
	`¡¹ok
(
i
 ? 
NULL
 : 
bufãr
, ":");

64 
où‘
[
i
] = (
¡r
 ? 
	`¡¹Ş
(str, 0, 16) : 0);

66 
	}
}

68 
boŞ
 
	gBSSID
::
	$equ®s
(
BSSID
 *
Ùh”
)

70 
i
=0; i<6; i++)

71 ià(
Ùh”
->
où‘
[
i
] !ğ
this
->octet[i])

72  
çl£
;

74  
Œue
;

75 
	}
}

77 
boŞ
 
	gBSSID
::
	$equ®s
(cÚ¡ *
‹xtu®
)

79 
BSSID
 *
Ùh”
;

80 
boŞ
 
»suÉ
;

82 
Ùh”
 = 
Ãw
 
	`BSSID
(
‹xtu®
);

83 
»suÉ
 = 
	`equ®s
(
Ùh”
);

84 
d–‘e
 
Ùh”
;

86  
»suÉ
;

87 
	}
}

89 *
	gBSSID
::
	$»nd”
(*
buf
)

91 
	`¥rštf
(
buf
, "%2x:%2x:%2x:%2x:%2x:%2x",

92 
où‘
[0], octet[1], octet[2], octet[3], octet[4], octet[5]

95 
i
=0; i<17; i++)

96 ià(
buf
[
i
] == ' ')

97 
buf
[
i
] = '0';

99  
buf
;

100 
	}
}

	@librwl/location.cc

49 
	~<¡ršg.h
>

50 
	~<¡dio.h
>

51 
	~<¡dlib.h
>

52 
	~<m©h.h
>

54 
	~"ev®.h
"

56 
	gloÿtiÚRecÜd
::
	$loÿtiÚRecÜd
(cÚ¡ *
desütiÚ
, 
x
, 
y
, 
z
)

58 
	`¡ºıy
(
this
->
desütiÚ
, description, (this->description));

59 
this
->
desütiÚ
[(this->description)-1] = 0;

61 
this
->
x
 = x;

62 
this
->
y
 = y;

63 
this
->
z
 = z;

65 ià(
	`¡¾’
(
desütiÚ
)>(
this
->description)) {

66 
	`´štf
("DesütiÚoØlÚg: %s\n", 
desütiÚ
);

67 
	`ex™
(1);

69 
	}
}

71 
	gloÿtiÚRecÜd
::
	$loÿtiÚRecÜd
(cÚ¡ *
desütiÚ
, 
x
, 
y
, 
z
,

72 
ssi_152
, 
ssi_153
, 
ssi_154
, 
ssi_156
, 
ssi_157
, 
ssi_160
)

74 
	`¡ºıy
(
this
->
desütiÚ
, description, (this->description));

75 
this
->
desütiÚ
[(this->description)-1] = 0;

77 
this
->
x
 = x;

78 
this
->
y
 = y;

79 
this
->
z
 = z;

81 
this
->
ssi_152
 = ssi_152;

82 
this
->
ssi_153
 = ssi_153;

83 
this
->
ssi_154
 = ssi_154;

84 
this
->
ssi_156
 = ssi_156;

85 
this
->
ssi_157
 = ssi_157;

86 
this
->
ssi_160
 = ssi_160;

88 ià(
	`¡¾’
(
desütiÚ
è> (
this
->description)) {

89 
	`´štf
("DesütiÚoØlÚg: %s\n", 
desütiÚ
);

90 
	`ex™
(1);

92 
	}
}

94 
	gloÿtiÚRecÜd
::
	$dump
()

96 
	`´štf
("[%4d %3d %d][%4à%4à%4à%4à%4à%4f] %s\n", 
x
, 
y
, 
z
, 
ssi_152
, 
ssi_153
, 
ssi_154
, 
ssi_156
, 
ssi_157
, 
ssi_160
, 
desütiÚ
);

97 
	}
}

99 
boŞ
 
	gloÿtiÚRecÜd
::
	$isAt
(
x
, 
y
, 
z
)

101  ((
this
->
x
 =ğxè&& (this->
y
 =ğyè&& (this->
z
 == z));

102 
	}
}

104 
boŞ
 
	gloÿtiÚRecÜd
::
	$desütiÚEqu®s
(cÚ¡ *
desütiÚ
)

106  !
	`¡rcmp
(
this
->
desütiÚ
, description);

107 
	}
}

109 
boŞ
 
	gloÿtiÚRecÜd
::
	$equ®s
(cÚ¡ *
desütiÚ
, 
x
, 
y
, 
z
)

111  (
	`isAt
(
x
, 
y
, 
z
è&& 
	`desütiÚEqu®s
(
desütiÚ
));

112 
	}
}

114 
boŞ
 
	gloÿtiÚRecÜd
::
	$loÿtiÚ_Çme_equ®s
(cÚ¡ *
desütiÚ
)

116  (
	`desütiÚEqu®s
(
desütiÚ
));

117 
	}
}

119 
boŞ
 
	gloÿtiÚRecÜd
::
	$equ®s
(
loÿtiÚRecÜd
 *
Ùh”
)

121  
	`equ®s
(
Ùh”
->
desütiÚ
, oth”->
x
, oth”->
y
, oth”->
z
);

122 
	}
}

124 *
	gloÿtiÚRecÜd
::
	$»nd”
(*
bufãr
)

126 
	`¥rštf
(
bufãr
, "%s", 
desütiÚ
);

127  
bufãr
;

128 
	}
}

130 
	gloÿtiÚRecÜd
::
	$g‘X
()

132  
x
;

133 
	}
}

135 
	gloÿtiÚRecÜd
::
	$g‘Y
()

137  
y
;

138 
	}
}

140 
	gloÿtiÚRecÜd
::
	$g‘Z
()

142  
z
;

143 
	}
}

144 
	gloÿtiÚRecÜd
::
	$g‘152
()

146  
ssi_152
;

147 
	}
}

148 
	gloÿtiÚRecÜd
::
	$g‘153
()

150  
ssi_153
;

151 
	}
}

152 
	gloÿtiÚRecÜd
::
	$g‘154
()

154  
ssi_154
;

155 
	}
}

156 
	gloÿtiÚRecÜd
::
	$g‘156
()

158  
ssi_156
;

159 
	}
}

160 
	gloÿtiÚRecÜd
::
	$g‘157
()

162  
ssi_157
;

163 
	}
}

164 
	gloÿtiÚRecÜd
::
	$g‘160
()

166  
ssi_160
;

167 
	}
}

169 
	gloÿtiÚRecÜd
::
	$di¡ªûTo
(
loÿtiÚRecÜd
 *
Ùh”
)

171  
	`di¡ªûTo
(
Ùh”
->
x
, oth”->
y
, oth”->
z
);

172 
	}
}

174 
	gloÿtiÚRecÜd
::
	$di¡ªûTo
(
x
, 
y
, 
z
)

176 
dx
 = 
this
->
x
 - x;

177 
dy
 = 
this
->
y
 - y;

178 
dz
 = (
this
->
z
 - z)*42;

180  (è
	`sq¹
(
dx
*dx + 
dy
*dy + 
dz
*dz);

181 
	}
}

183 
loÿtiÚRecÜd
 *
	gloÿtiÚRecÜd
::
	$şÚe
()

185  
Ãw
 
	`loÿtiÚRecÜd
(
desütiÚ
, 
x
, 
y
, 
z
);

186 
	}
}

	@librwl/markov.cc

49 
	~"ev®.h
"

51 
	gHidd’M¬kovMod–
::
	$Hidd’M¬kovMod–
(
TİŞogyMod–
 *
mod–
)

53 
this
->
mod–
 = model;

54 
	}
}

56 
	gHidd’M¬kovMod–
::
	$upd©e
(
´obab™yVeùÜ
 *
v
)

58 
pLoÿtiÚ
[
maxLoÿtiÚs
];

59 cÚ¡ 
pRemaš
 = 0.7;

61 
i
=0; i<
maxLoÿtiÚs
; i++)

62 
pLoÿtiÚ
[
i
] = 
pRemaš
 * 
v
->pLocation[i];

64 
i
=0; i<
maxLoÿtiÚs
; i++) {

65 
numNeighbours
 = 
mod–
->
	`g‘NumNeighbours
(
i
);

66 ià(
numNeighbours
 > 0) {

67 
³rNeighbour
 = ((1.0 - 
pRemaš
è* 
v
->
pLoÿtiÚ
[
i
]è/ 
numNeighbours
;

68 
j
=0; j<
numNeighbours
; j++)

69 
pLoÿtiÚ
[
mod–
->
	`g‘Neighbour
(
i
, 
j
)] +ğ
³rNeighbour
;

73 
i
=0; i<
maxLoÿtiÚs
; i++)

74 
v
->
pLoÿtiÚ
[
i
] =…Location[i];

75 
	}
}

	@librwl/mlhood.cc

49 
	~<¡dlib.h
>

50 
	~<¡dio.h
>

51 
	~<¡ršg.h
>

52 
	~<m©h.h
>

53 
	~<as£¹.h
>

54 
	~"ev®.h
"

57 
	#d´štf
(
a
...)

	)

59 
æag
;

61 
	#MIN_SIR
 0

	)

67 
	gGMMLoÿliz”
::
	$GMMLoÿliz”
Ğ
ŒaššgD©aPackage
 *
d©a
) {

70 
j
 = 0; j < 
NUM_LOCATIONS
 ; j++) {

71 
p
[
j
] = (è1.0 / 
NUM_LOCATIONS
;

74 
k
 = 0; k < 
NUM_POWER_LEVELS
 ; k++) {

75 
q
[
k
] = (è1.0 / 
NUM_POWER_LEVELS
;

78 
i
 = 0; i < 
NUM_SNIFFERS
; i++)

79 
j
 = 0; j < 
NUM_LOCATIONS
 ; j++)

80 
k
 = 0; k < 
NUM_POWER_LEVELS
 ; k++)

81 
sigma
[
i
][
j
][
k
] = (è
STD_DEVIATION
;

86 
i
 = 0; i < 
NUM_SNIFFERS
; i++) {

87 
j
 = 0; j < 
NUM_LOCATIONS
 ; j++) {

88 
k
 = 0; k < 
NUM_POWER_LEVELS
 ; k++) {

90 ià(
k
 < 
MID_POINT_POWER_LEVEL
)

91 
mu
[
i
][
j
][
k
] = 
d©a
->
sûÇrio
->
š™_sigÇl
[i][j] - (
RATE_OF_INCREASE
 * (
MID_POINT_POWER_LEVEL
 - k)) ;

92 ià(
k
 =ğ
MID_POINT_POWER_LEVEL
)

93 
mu
[
i
][
j
][
k
] = 
d©a
->
sûÇrio
->
š™_sigÇl
[i][j];

95 
mu
[
i
][
j
][
k
] = 
d©a
->
sûÇrio
->
š™_sigÇl
[i][j] + (
RATE_OF_INCREASE
 * (k - 
MID_POINT_POWER_LEVEL
) ) ;

98 ià(
mu
[
i
][
j
][
k
] < 0)

99 
mu
[
i
][
j
][
k
] = 0;

104 
	}
}

106 
	gGMMLoÿliz”
::
	$p_v®ue
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
j
, 
k
) {

107 
pçùÜ
 = 1.0;

108 
pdf
;

110 
	`´štf
("\n");

112  
i
 = 0; i < 
NUM_SNIFFERS
; i++) {

113 
x
 = 
ob£rv©iÚ
->
sœ
[
i
];

115 
pdf
 = (1 / (
sigma
[
i
][
j
][
k
]*
	`sq¹
(2*3.1415926))è* (
	`exp
Ğ-((
x
-
mu
[i][j][k]) * (x-mu[i][j][k])) /

116 (2*
sigma
[
i
][
j
][
k
] * sigma[i][j][k]) ));

117 
	`´štf
("%LF-%Là ",
mu
[
i
][
j
][
k
], 
pdf
);

118 
pçùÜ
 *ğ
pdf
;

121 
pçùÜ
 *ğ(
p
[
j
] * 
q
[
k
]);

122 
	`´štf
("pçùÜ:%Là ", 
pçùÜ
);

123  
pçùÜ
;

124 
	}
}

127 
	gGMMLoÿliz”
::
	$log_p_v®ue
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
j
, 
k
) {

128 
log_‹rm
 = 0.0, 
sum_logpdf
 = 0.0;

129 
m_jk
 = 0.0;

130 
	`d´štf
("\n");

132  
i
 = 0; i < 
NUM_SNIFFERS
; i++) {

133 
x
 = 
ob£rv©iÚ
->
sœ
[
i
];

134 
	`d´štf
 ("¢ifãr#i=%d j=%d k=%d x=%4d mu=%14L\n", 
i
, 
j
, 
k
, 
x
, 
mu
[i][j][k]);

136 
log_‹rm
 = ( ( (-1.0 /2.0 ) * ( ((
x
 - 
mu
[
i
][
j
][
k
]) * (x - mu[i][j][k])) /

137 Ğ
sigma
[
i
][
j
][
k
] * sigma[i][j][k]) ) ) -

138 
	`log
(
sigma
[
i
][
j
][
k
] * 
	`sq¹
(2 * 3.1416)) );

140 
	`d´štf
("v®ue=%14Le: ",
log_‹rm
 );

141 
´ob
 = 
	`exp
(
log_‹rm
);

142 
	`d´štf
("´ob=%14Le: \n",
´ob
);

144 
sum_logpdf
 +ğ
log_‹rm
;

146 
m_jk
 = 
	`log
(
p
[
j
]è+†og(
q
[
k
]è+ 
sum_logpdf
 ;

148  
m_jk
;

149 
	}
}

151 
	gGMMLoÿliz”
::
	$Ex³ù©iÚMaximiz©iÚ
(
ŒaššgD©aPackage
 *
d©a
) {

153 
	sProbV®ueNode
 {

154 
pi
[
NUM_LOCATIONS
][
NUM_POWER_LEVELS
];

155 
ProbV®ueNode
 *
Ãxt
;

156 } 
	t´obNode
 ;

158 
´obNode
 *
h—d
, *
tmp
;

160 
Ïmbda
[
NUM_LOCATIONS
];

161 
rho
[
NUM_POWER_LEVELS
];

162 
N
[
NUM_LOCATIONS
][
NUM_POWER_LEVELS
];

164 
Y
 = 0.0;

165 
sum
 = 0.0;

166 
m
[
NUM_LOCATIONS
][
NUM_POWER_LEVELS
];

167 
M
 = 
d©a
->
numOb£rv©iÚs
;

169 
	`´štf
("NØoàob£rv©iÚs: %d\n", 
M
);

170 
	`´štf
("NØoàLoÿtiÚs: %d\n", 
NUM_LOCATIONS
);

171 
	`´štf
("NØoàPow”Lev–s: %d\n", 
NUM_POWER_LEVELS
);

172 
	`´štf
("NØoàSnifãrs: %d\n", 
NUM_SNIFFERS
);

173 
	`fæush
(
¡dout
);

175 iàĞ
M
 == 0) {

176 
	`´štf
("NØoàob£rv©iÚ 0 !! NØEM…ossibË !!\n"); 
	`fæush
(
¡dout
);

180  
t
 = 0; < 
MAX_CONVERGE
;++) {

183 
	`d´štf
("\n\Àˆğ%d\n", 
t
);

184 
	`d´štf
( "\np-vector: ");

185  
j
 = 0; j < 
NUM_LOCATIONS
; j++) {

186 
	`d´štf
 ("%Là", 
p
[
j
]);

188 
	`d´štf
( "\nq-vector: ");

189  
k
 = 0; k < 
NUM_POWER_LEVELS
; k++) {

190 
	`d´štf
 ("%Là", 
q
[
k
]);

192 
	`d´štf
("\nmu-vector: \n");

193 
i
 = 0; i < 
NUM_SNIFFERS
; i ++) {

194 
	`d´štf
("\n\n***Snifãr: %d***\n", 
i
);

195 
j
 = 0; j < 
NUM_LOCATIONS
 ; j++) {

196 
	`d´štf
("\n\Æocid:%d ", 
j
);

197 
k
 = 0; k < 
NUM_POWER_LEVELS
 ; k++)

198 
	`d´štf
(" [#%2d]%2.4Là",
k
, 
mu
[
i
][
j
][k]);

203 
h—d
 = 
NULL
;

206 
l
 = 0;† < 
M
 ;†++) {

208 
tmp
 = (
´obNode
 *è
	`m®loc
( (probNode));

209  
j
 = 0; j < 
NUM_LOCATIONS
 ; j++) {

210  
k
 = 0; k < 
NUM_POWER_LEVELS
; k++)

211 
tmp
->
pi
[
j
][
k
] = 0;

213 
tmp
->
Ãxt
 = 
h—d
;

217 
Y
 = 0.0;

218 
j
 = 0; j < 
NUM_LOCATIONS
 ; j++) {

219 
k
 = 0; k < 
NUM_POWER_LEVELS
 ; k++) {

221 
m
[
j
][
k
] = 
	`log_p_v®ue
Ğ&(
d©a
->
ob£rv©iÚ
[
l
]), j, k);

222 
Y
 +ğ
	`exp
(
m
[
j
][
k
]);

225 
	`d´štf
("\ÀY=: %Là ", 
Y
);

226 
j
 = 0; j < 
NUM_LOCATIONS
 ; j++) {

227 
	`d´štf
("\n\ÀLoÿtiÚ - %d \n", 
j
);

228 
k
 = 0; k < 
NUM_POWER_LEVELS
 ; k++) {

229 
num”©Ü
 = 
	`exp
(
m
[
j
][
k
]) ;

230 iàĞ
Y
 != 0.0 ) {

231 
tmp
->
pi
[
j
][
k
] = 
num”©Ü
 / 
Y
;

233 
	`´štf
("\n\nERROR !! iÀfunùiÚ 'GMMLoÿliz”::Ex³ù©iÚMaximiz©iÚ'.Inv®id v®uoàY. Ex™šg ! \n"); 
	`fæush
(
¡dout
);

234 
	`ex™
(1);

237 #ifdeà
USE_MINLIMIT


238 ifĞ
tmp
->
pi
[
j
][
k
] < 0.000001)

239 
tmp
->
pi
[
j
][
k
] = 0.0;

241 
	`d´štf
("[%d: %.4Lf] ", 
k
, 
pi
[
l
][
j
][k]);

244 
h—d
 = 
tmp
;

251 
j
 = 0; j < 
NUM_LOCATIONS
 ; j++) {

252 
sum
 = 0.0;

253 
tmp
 = 
h—d
;

254 
tmp
 !ğ
NULL
) {

255 
k
 = 0; k < 
NUM_POWER_LEVELS
; k++){

256 
sum
 +ğ
tmp
->
pi
[
j
][
k
];

258 
tmp
 =mp->
Ãxt
;

260 
Ïmbda
[
j
] = 
sum
;

262 
k
 = 0; k < 
NUM_POWER_LEVELS
 ; k++) {

263 
sum
 = 0.0;

264 
tmp
 = 
h—d
;

265 
tmp
 !=
NULL
) {

266 
j
 = 0; j < 
NUM_LOCATIONS
; j++) {

267 
sum
 +ğ
tmp
->
pi
[
j
][
k
];

269 
tmp
 =mp->
Ãxt
;

271 
rho
[
k
] = 
sum
;

274 
	`d´štf
("\nDEBUG-0\n");

275 
j
 = 0; j < 
NUM_LOCATIONS
 ; j++) {

276 
k
 = 0; k < 
NUM_POWER_LEVELS
 ; k++) {

277 
sum
 = 0.0;

278 
tmp
 = 
h—d
;

279  
tmp
 !ğ
NULL
 ) {

280 
sum
 +ğ
tmp
->
pi
[
j
][
k
];

281 
tmp
 =mp->
Ãxt
;

283 
N
[
j
][
k
] = 
sum
;

284 
	`d´štf
("j=%d, k=%d, N=%Le\n", 
j
,
k
, 
N
[j][k]);

291 
j
 = 0; j < 
NUM_LOCATIONS
 ; j++) {

292 
p
[
j
] = 
Ïmbda
[j] / 
M
;

295 
k
 = 0; k < 
NUM_POWER_LEVELS
 ; k++) {

296 
q
[
k
] = 
rho
[k] / 
M
;

297 
	`d´štf
("k:%d„ho:%Là sum:%Làq[%d]:%Lf\n",
k
, 
rho
[k], 
sum
,k, 
q
[k]);

300 
	`d´štf
("\nDEBUG\n");

302 
j
 = 0; j < 
NUM_LOCATIONS
 ; j++) {

303 
k
 = 0; k < 
NUM_POWER_LEVELS
 ; k++) {

304  
i
 = 0; i < 
NUM_SNIFFERS
; i++) {

306 
sum
 = 0.0;

307 
tmp
 = 
h—d
;

308 
l
 = (
d©a
->
numOb£rv©iÚs
 - 1);† >=0 && 
tmp
 !=
NULL
;†--) {

309 
sum
 +ğĞ
tmp
->
pi
[
j
][
k
] * 
d©a
->
ob£rv©iÚ
[
l
].
sœ
[
i
] );

310 
tmp
 =mp->
Ãxt
;

313 ià(
N
[
j
][
k
] != 0.0)

314 
mu
[
i
][
j
][
k
] = 
sum
 / 
N
[j][k];

316 
mu
[
i
][
j
][
k
] = 0.0;

318 
	`d´štf
("\Ài=%d , j=%d, k=%d, mu=%Le, sum=%Le, N=%Le\n", 
i
, 
j
, 
k
, 
mu
[i][j][k], 
sum
, 
N
[j][k]);

324 
h—d
) {

325 
tmp
 = 
h—d
->
Ãxt
;

326 
	`ä“
(
h—d
);

327 
h—d
 = 
tmp
;

331 #ifdeà
LOG_LIKELIHOOD


333 
log_lik–ihood
 = 0.0;

334 
l
 = 0;† < 
d©a
->
numOb£rv©iÚs
;†++) {

335 
	`´štf
("\nob£rv©iÚ %d:", 
l
);

336 
d©a
->
ob£rv©iÚ
[
l
].
	`dump
();

338 
Y
 = 0.0;

339 
j
 = 0; j < 
NUM_LOCATIONS
 ; j++) {

340 
k
 = 0; k < 
NUM_POWER_LEVELS
 ; k++) {

341 
m
[
j
][
k
] = 
	`log_p_v®ue
Ğ&(
d©a
->
ob£rv©iÚ
[
l
]), j, k);

342 
Y
 +ğ
	`exp
(
m
[
j
][
k
]);

345 
	`´štf
("\ÀY=: %L ", 
Y
);

346 
log_lik–ihood
 +ğ
	`log
(
Y
);

347 
	`´štf
("\ÀcumuÏtivlog_lik–ihood = : %L ", 
log_lik–ihood
);

349 
log_lik–ihood
 = (log_lik–ihoodè/ 
d©a
->
numOb£rv©iÚs
;

351 
FILE
 *
Îhood
;

352 
Îhood
 = 
	`fİ’
 ("log_likelihood.txt", "a+");

353 ià(!
Îhood
) {

354 
	`´štf
("Error! Failed in writingo†og_likelihood");

355 
	`ex™
(1);

357 
	`årštf
(
Îhood
, "%Le\n", 
log_lik–ihood
);

358 
	`fşo£
(
Îhood
);

362 
	}
}

364 
	gGMMLoÿliz”
::
	$loÿlize
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
´obab™yVeùÜ
 *
v
) {

366 
Y
 = 0.0;

367 
m
[
NUM_LOCATIONS
][
NUM_POWER_LEVELS
];

368 
p
[
NUM_LOCATIONS
][
NUM_POWER_LEVELS
];

372 
j
 = 0; j < 
NUM_LOCATIONS
 ; j++) {

373 
k
 = 0; k < 
NUM_POWER_LEVELS
 ; k++) {

375 
m
[
j
][
k
] = 
	`log_p_v®ue
Ğ
ob£rv©iÚ
, j, k);

376 
Y
 +ğ
	`exp
(
m
[
j
][
k
]);

380 
j
 = 0; j < 
NUM_LOCATIONS
 ; j++) {

381 
k
 = 0; k < 
NUM_POWER_LEVELS
 ; k++) {

382 iàĞ
Y
 <= 0) {

383 
	`´štf
("\n\nERROR !! iÀfunùiÚ 'GMMLoÿliz”::loÿlize'. Ex™šg ! \n"); 
	`fæush
(
¡dout
);

384 
	`ex™
(1);

386 
p
[
j
][
k
] = 
	`exp
Ğ
m
[j][k]è/ (
Y
);

390 
j
 = 0; j < 
NUM_LOCATIONS
 ; j++) {

391 
sum_k
 = 0.0;

392 
k
 = 0; k < 
NUM_POWER_LEVELS
 ; k++) {

394 
sum_k
 +ğ
p
[
j
][
k
];

396 
v
->
pLoÿtiÚ
[
j
] = 
sum_k
;

398 
	}
}

402 
	gMaximumLik–ihoodLoÿliz”
::
	$MaximumLik–ihoodLoÿliz”
(
ŒaššgD©aPackage
 *
d©a
, 
wdÿrds
)

404 
NumSnifãrs
 = 
d©a
->
sûÇrio
->
	`g‘NumAP
();

405 
sûÇrio
 = 
d©a
->scenario;

406 
this
->
wdÿrds
 = wildcards;

408 
k
 = 0; k < 
d©a
->
sûÇrio
->
	`g‘NumLoÿtiÚs
(); k++) {

410 
sigmasqu¬e_diff
[
NumSnifãrs
][NumSniffers];

411 
av”age_diff
[
NumSnifãrs
][NumSniffers];

413 
i
 = 0; i < 
NumSnifãrs
; i++) {

414 
j
 = 0 ; j < 
NumSnifãrs
; j++) {

415 
av”age_diff
[
i
][
j
] = 0;

416 
sigmasqu¬e_diff
[
i
][
j
] = 0;

423 
i
 = 0; i < 
d©a
->
numOb£rv©iÚs
; i++) {

424 ià(
d©a
->
loÿtiÚIndex
[
i
] =ğ
k
) {

425 
®pha
 = 0;‡Íh¨< 
NumSnifãrs
 - 1;‡lpha++) {

426 
b‘a
 = 
®pha
 + 1; b‘¨< 
NumSnifãrs
 ; beta++) {

431 
av”age_diff
[
®pha
][
b‘a
] +ğ(
d©a
->
ob£rv©iÚ
[
i
].
sœ
[alpha] - data->observation[i].sir[beta]);

444 
i
 = 0; i < 
NumSnifãrs
; i++)

445 
j
 = 0; j < 
NumSnifãrs
; j++)

446 
av”age_diff
[
i
][
j
] /ğ
NUM_OBSERVATIONS
;

451 
i
 = 0; i < 
d©a
->
numOb£rv©iÚs
; i++) {

452 ià(
d©a
->
loÿtiÚIndex
[
i
] =ğ
k
) {

453 
®pha
 = 0;‡Íh¨< 
NumSnifãrs
 -1;‡lpha++) {

454 
b‘a
 = 
®pha
 + 1; b‘¨< 
NumSnifãrs
; beta++) {

456 
x
 = (
d©a
->
ob£rv©iÚ
[
i
].
sœ
[
®pha
] - d©a->ob£rv©iÚ[i].sœ[
b‘a
]);

457 
sigmasqu¬e_diff
[
®pha
][
b‘a
] +=

458 (
x
 - 
av”age_diff
[
®pha
][
b‘a
]) * (x -‡verage_diff[alpha][beta]);

469 
i
 = 0; i < 
NumSnifãrs
 ; i++) {

470 
j
 = 0; j < 
NumSnifãrs
 ; j++) {

474 ià(
sigmasqu¬e_diff
[
i
][
j
] < 1)

475 
sigmasqu¬e_diff
[
i
][
j
] = 1;

477 
sigmasqu¬e_diff
[
i
][
j
] /ğ
NUM_OBSERVATIONS
;

497 
i
 = 0; i < 
NumSnifãrs
; i++) {

498 
j
 = 0; j < 
NumSnifãrs
; j++) {

499 
sigma2
[
k
][
i
][
j
] = 
	`sq¹
(
sigmasqu¬e_diff
[i][j]);

500 
mu2
[
k
][
i
][
j
] = 
av”age_diff
[i][j];

504 
	}
}

510 
	gMaximumLik–ihoodLoÿliz”
::
	$loÿlize
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
´obab™yVeùÜ
 *
v
)

514 
i
 = 0; i < 
sûÇrio
->
	`g‘NumLoÿtiÚs
(); i++) {

516 
loÿtiÚFaùÜ
 = 0;

518 
buf
[256];

519 
	`d´štf
("+++ LoÿtiÚ upd©fÜ (%dè%s\n", 
i
, 
sûÇrio
->
	`g‘LoÿtiÚ
(i)->
	`»nd”
(
buf
));

525 
®pha
 = 0;‡Íh¨< 
NumSnifãrs
 ;‡lpha++) {

526 
b‘a
 = 
®pha
 + 1; b‘¨< 
NumSnifãrs
 ; beta++) {

531 
x
 = 
ob£rv©iÚ
->
sœ
[
®pha
] - ob£rv©iÚ->sœ[
b‘a
];

532 
çùÜ
 = (1 /(
sigma2
[
i
][
®pha
][
b‘a
] * 
	`sq¹
(2*3.14159265))) *

533 
	`exp
Ğ-((
x
 - 
mu2
[
i
][
®pha
][
b‘a
]) * (x - mu2[i][alpha][beta]))

534 / (2 * 
sigma2
[
i
][
®pha
][
b‘a
] * sigma2[i][alpha][beta]) );

539 #ifdeà
USE_MINLIMIT


540 ià(
çùÜ
<0.00001)

541 
çùÜ
 = 0.00001;

543 
	`d´štf
("AP#%2d: % SIR=%3d faùÜ=%.8f\n", 
j
, 
sûÇrio
->
	`g‘AP
(j)->
	`g‘BSSID
()->
	`»nd”
(
buf
), 
ob£rv©iÚ
->
sœ
[j], 
çùÜ
);

545 
loÿtiÚFaùÜ
 +ğ
çùÜ
;

548 
v
->
pLoÿtiÚ
[
i
] = 
loÿtiÚFaùÜ
;

550 
	}
}

552 
	gMaximumLik–ihoodLoÿliz”
::
	$g‘Sigma
(
loÿtiÚIndex
, 
­Index
)

554 
	`as£¹
((
loÿtiÚIndex
>=0è&& (loÿtiÚIndex<=
sûÇrio
->
	`g‘NumLoÿtiÚs
()));

555 
	`as£¹
((
­Index
>=0è&& (­Index<=
sûÇrio
->
	`g‘NumAP
()));

557  
sigma
[
loÿtiÚIndex
][
­Index
];

558 
	}
}

560 
	gMaximumLik–ihoodLoÿliz”
::
	$g‘Mu
(
loÿtiÚIndex
, 
­Index
)

562 
	`as£¹
((
loÿtiÚIndex
>=0è&& (loÿtiÚIndex<=
sûÇrio
->
	`g‘NumLoÿtiÚs
()));

563 
	`as£¹
((
­Index
>=0è&& (­Index<=
sûÇrio
->
	`g‘NumAP
()));

565  
mu
[
loÿtiÚIndex
][
­Index
];

566 
	}
}

568 
boŞ
 
	gMaximumLik–ihoodLoÿliz”
::
	$isGoodAP
(
loÿtiÚIndex
, 
­Index
)

570 
	`as£¹
((
loÿtiÚIndex
>=0è&& (loÿtiÚIndex<=
sûÇrio
->
	`g‘NumLoÿtiÚs
()));

571 
	`as£¹
((
­Index
>=0è&& (­Index<=
sûÇrio
->
	`g‘NumAP
()));

573  
goodAP
[
loÿtiÚIndex
][
­Index
];

574 
	}
}

576 
	gMaximumLik–ihoodLoÿliz”
::
	$MaximumLik–ihoodLoÿliz”
(
sûÇrioDesütÜ
 *
sûÇrio
, cÚ¡ *
mlFeName
, 
wdÿrds
)

578 
this
->
sûÇrio
 = scenario;

579 
this
->
wdÿrds
 = wildcards;

581 
i
=0; i<
maxLoÿtiÚs
; i++) {

582 
j
=0; j<
maxAP
; j++) {

583 
sigma
[
i
][
j
] = 0;

584 
mu
[
i
][
j
] = 0;

585 
goodAP
[
i
][
j
] = 
çl£
;

589 
FILE
 *
f
 = 
	`fİ’
(
mlFeName
, "r");

590 ià(!
f
)

591 
	`·nic
("CªnÙ o³ÀML ffÜ„—dšg: %s", 
mlFeName
);

593 
lšebuf
[200];

594 
cu¼’tLoÿtiÚ
 = -1;

596 !
	`ãof
(
f
)) {

598 
	`fg‘s
(
lšebuf
, Öšebuf), 
f
);

599 
	`¡¹ok
(
lšebuf
, "\r\n");

600 } !
lšebuf
[0] && !
	`ãof
(
f
));

602 ià(
	`ãof
(
f
))

605 ià(!
	`¡ºcmp
(
lšebuf
, " - ", 4)) {

606 ià(
cu¼’tLoÿtiÚ
 == -1)

607 
	`·nic
("ML file formatƒrror");

610 *
bssid
 = 
	`¡¹ok
(&
lšebuf
[4], " ");

611 
lšebuf
[23] = 0;

612 *
m
 = &
lšebuf
[24];

613 
lšebuf
[30] = 0;

614 *
s
 = &
lšebuf
[33];

615 
lšebuf
[38] = 0;

616 *
d
 = &
lšebuf
[41];

617 
lšebuf
[46] = 0;

618 *
m
==' ') m++;

619 *
s
==' ') s++;

620 *
d
==' ') d++;

621 
­Index
 = 
sûÇrio
->
	`g‘ApIndex
(
bssid
);

622 ià(
­Index
 < 0)

623 
	`·nic
("AP‚Ù found: %s", 
bssid
);

625 
mu
[
cu¼’tLoÿtiÚ
][
­Index
] = 
	`©of
(
m
);

626 
sigma
[
cu¼’tLoÿtiÚ
][
­Index
] = 
	`©of
(
s
);

627 
goodAP
[
cu¼’tLoÿtiÚ
][
­Index
] = (
	`©of
(
d
)<0.02);

629 
cu¼’tLoÿtiÚ
 = 
sûÇrio
->
	`g‘LoÿtiÚIndex
(
lšebuf
);

630 ià(
cu¼’tLoÿtiÚ
 == -1)

631 
	`·nic
("LoÿtiÚ‚Ù found: %s", 
lšebuf
);

635 
	`fşo£
(
f
);

636 
	}
}

638 
	gMaximumLik–ihoodLoÿliz”
::
	$upd©eRawProbab™›s
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
´obab™yVeùÜ
 *
v
)

640 
i
=0; i<
sûÇrio
->
	`g‘NumLoÿtiÚs
(); i++) {

641 
loÿtiÚFaùÜ
 = 1.0;

643 
j
=0; j<
sûÇrio
->
	`g‘NumAP
(); j++) {

644 ià(
ob£rv©iÚ
->
sœ
[
j
] > 
MIN_SIR
) {

645 
çùÜ
 = (1/(
sigma
[
i
][
j
]*
	`sq¹
(2*3.14159265)))*
	`exp
(-(
ob£rv©iÚ
->
sœ
[j]-
mu
[i][j])*(observation->sir[j]-mu[i][j])/(2*sigma[i][j]*sigma[i][j]));

647 ià(
çùÜ
<0.00001)

648 
çùÜ
 = 0.00001;

650 
loÿtiÚFaùÜ
 *ğ
çùÜ
;

654 
v
->
pLoÿtiÚ
[
i
] *ğ
loÿtiÚFaùÜ
;

657 
i
=
sûÇrio
->
	`g‘NumLoÿtiÚs
(); i<
maxLoÿtiÚs
; i++)

658 
v
->
pLoÿtiÚ
[
i
] = 0;

659 
	}
}

	@librwl/observation.cc

49 
	~<¡dio.h
>

50 
	~<as£¹.h
>

51 
	~"ev®.h
"

53 
	gob£rv©iÚRecÜd
::
	$ob£rv©iÚRecÜd
()

55 
	`z”o
();

56 
	}
}

58 
	gob£rv©iÚRecÜd
::
	$numVisibËAPs
()

60 
»suÉ
 = 0;

62 
i
=0; i<
MAX_AP
; i++)

63 ià(
sœ
[
i
]>0)

64 
»suÉ
 ++;

66  
»suÉ
;

67 
	}
}

69 
	gob£rv©iÚRecÜd
::
	$­¶yCÜ»ùive
(
a
, 
b
, 
c
)

71 
i
=0; i<
MAX_AP
; i++) {

72 ià(
sœ
[
i
]>0) {

73 
sœ
[
i
] = ()(
a
*sœ[i]*sœ[i] + 
b
*sœ[i] + 
c
);

74 ià(
sœ
[
i
] < 0)

75 
sœ
[
i
] = 0;

76 ià(
sœ
[
i
] > 255)

77 
sœ
[
i
] = 255;

80 
	}
}

82 
	gob£rv©iÚRecÜd
::
	$£tTo
(
iSIR
, 
iSNR
)

84 
i
=0; i<
MAX_AP
; i++) {

85 
sœ
[
i
] = 
iSIR
;

86 
¢r
[
i
] = 
iSNR
;

88 
	}
}

90 
	gob£rv©iÚRecÜd
::
	$z”o
()

92 
	`£tTo
(0, 0);

93 
	}
}

95 
boŞ
 
	gob£rv©iÚRecÜd
::
	$isV®id
() {

96  
i
 = 0; i < 
MAX_AP
; i++) {

97 ià(
sœ
[
i
])

101 
	}
}

103 
	gob£rv©iÚRecÜd
::
	$dump
()

105 
i
=0; i < 
NUM_SNIFFERS
; i++)

106 
	`´štf
("%3d ", 
sœ
[
i
]);

108 
	`´štf
("\n");

109 
	}
}

111 
	gob£rv©iÚRecÜd
::
	$euşid—nDi¡ªûSqProj
(
ob£rv©iÚRecÜd
 *
Ùh”
)

113 
»suÉ
 = 0;

115 
i
=0; i<
MAX_AP
; i++)

116 ià(
sœ
[
i
])

117 
»suÉ
 +ğ(
Ùh”
->
sœ
[
i
]-sir[i])*(other->sir[i]-sir[i]);

119  
»suÉ
;

120 
	}
}

122 
	gob£rv©iÚRecÜd
::
	$euşid—nDi¡ªûSq
(
ob£rv©iÚRecÜd
 *
Ùh”
)

124 
»suÉ
 = 0;

126 
i
=0; i<
MAX_AP
; i++)

127 
»suÉ
 +ğ(
Ùh”
->
sœ
[
i
]-sir[i])*(other->sir[i]-sir[i]);

129  
»suÉ
;

130 
	}
}

132 
	gob£rv©iÚRecÜd
::
	$euşid—nDi¡ªûSqLoc
(
loÿtiÚRecÜd
 *
LOC
) {

135 (
LOC
->
	`g‘152
(è- 
sœ
[0]) * (LOC->get152() - sir[0]) +

136 (
LOC
->
	`g‘153
(è- 
sœ
[1]) * (LOC->get153() - sir[1]) +

137 (
LOC
->
	`g‘154
(è- 
sœ
[2]) * (LOC->get154() - sir[2]) +

138 (
LOC
->
	`g‘156
(è- 
sœ
[3]) * (LOC->get156() - sir[3]) +

139 (
LOC
->
	`g‘157
(è- 
sœ
[4]) * (LOC->get157() - sir[4]) +

140 (
LOC
->
	`g‘160
(è- 
sœ
[5]) * (LOC->get160() - sir[5]) );

141 
	}
}

143 
	gob£rv©iÚRecÜd
::
	$add
(
ob£rv©iÚRecÜd
 *
Ùh”
)

145 
i
=0; i<
MAX_AP
; i++)

146 
sœ
[
i
] +ğ
Ùh”
->sir[i];

147 
	}
}

149 
	gob£rv©iÚRecÜd
::
	$divideBy
(
divisÜ
)

151 
	`as£¹
(
divisÜ
 != 0);

152 
i
=0; i<
MAX_AP
; i++)

153 
sœ
[
i
] /ğ
divisÜ
;

154 
	}
}

156 
	gob£rv©iÚRecÜd
::
	$adju¡Mš
(
ob£rv©iÚRecÜd
 *
Ùh”
)

158 
i
=0; i<
MAX_AP
; i++)

159 ià(
Ùh”
->
sœ
[
i
] < 
this
->sir[i])

160 
this
->
sœ
[
i
] = 
Ùh”
->sir[i];

161 
	}
}

163 
	gob£rv©iÚRecÜd
::
	$adju¡Max
(
ob£rv©iÚRecÜd
 *
Ùh”
)

165 
i
=0; i<
MAX_AP
; i++)

166 ià(
Ùh”
->
sœ
[
i
] > 
this
->sir[i])

167 
this
->
sœ
[
i
] = 
Ùh”
->sir[i];

168 
	}
}

170 
boŞ
 
	gob£rv©iÚRecÜd
::
	$di¡šùFrom
(
ob£rv©iÚRecÜd
 *
Ùh”
)

172 
i
=0; i<
MAX_AP
; i++)

173 ià((
this
->
sœ
[
i
]>0è&& (
Ùh”
->sir[i]>0))

174  
çl£
;

176  
Œue
;

177 
	}
}

179 
	gob£rv©iÚRecÜd
::
	$»moveAP
(
­Index
)

181 
i
=
­Index
; i<(
MAX_AP
-1); i++) {

182 
sœ
[
i
] = sir[i+1];

183 
¢r
[
i
] = snr[i+1];

186 
sœ
[
MAX_AP
-1] = 0;

187 
¢r
[
MAX_AP
-1] = 0;

188 
	}
}

	@librwl/pvector.cc

49 
	~<as£¹.h
>

51 
	~"ev®.h
"

53 
	g´obab™yVeùÜ
::
	$´obab™yVeùÜ
()

55 
i
 = 0; i < 
maxLoÿtiÚs
; i++)

56 
pLoÿtiÚ
[
i
] = 0;

57 
	}
}

59 
	g´obab™yVeùÜ
::
	$£tRªge
(
begš
, 
’d
, 
p
)

61 
i
 = 
begš
; i <ğ
’d
; i++)

62 
pLoÿtiÚ
[
i
] = 
p
;

63 
	}
}

65 
	g´obab™yVeùÜ
::
	$be¡LoÿtiÚIndex
()

67 
be¡P
 = 
pLoÿtiÚ
[0];

68 
be¡Index
 = 0;

70 
i
 = 1; i < 
NUM_LOCATIONS
; i++) {

71 ià(
pLoÿtiÚ
[
i
] > 
be¡P
) {

72 
be¡P
 = 
pLoÿtiÚ
[
i
];

73 
be¡Index
 = 
i
;

77  
be¡Index
;

78 
	}
}

80 
	g´obab™yVeùÜ
::
	$NNSS_be¡LoÿtiÚIndex
()

82 
be¡P
 = 
pLoÿtiÚ
[0];

83 
be¡Index
 = 0;

85 
i
 = 1; i < 
NUM_LOCATIONS
; i++) {

86 ià(
pLoÿtiÚ
[
i
] < 
be¡P
) {

87 
be¡P
 = 
pLoÿtiÚ
[
i
];

88 
be¡Index
 = 
i
;

92  
be¡Index
;

93 
	}
}

95 
	g´obab™yVeùÜ
::
	$£tAÎ
(
p
)

97 
	`£tRªge
(0, 
maxLoÿtiÚs
-1, 
p
);

98 
	}
}

100 
	g´obab™yVeùÜ
::
	$£t
(
šdex
, 
p
)

102 
	`as£¹
((
šdex
>=0è&& (šdex<
maxLoÿtiÚs
));

103 
pLoÿtiÚ
[
šdex
] = 
p
;

104 
	}
}

	@librwl/scenario.cc

49 
	~<¡dlib.h
>

50 
	~<¡ršg.h
>

51 
	~<¡dio.h
>

52 
	~<as£¹.h
>

54 
	~"ev®.h
"

56 
	gsûÇrioDesütÜ
::
	$sûÇrioDesütÜ
()

58 
numLoÿtiÚs
 = 0;

59 
numAP
 = 0;

60 
isLocked
 = 
çl£
;

61 
	}
}

63 
	gsûÇrioDesütÜ
::
	$sûÇrioDesütÜ
(cÚ¡ *
loÿtiÚFeName
, cÚ¡ *
­FeName
)

65 
lšebuf
[256];

66 
i
, 
j
;

68 
numLoÿtiÚs
 = 0;

69 
numAP
 = 0;

70 
isLocked
 = 
çl£
;

72 ià(
loÿtiÚFeName
) {

74 
FILE
 *
loÿtiÚFe
 = 
	`fİ’
(
loÿtiÚFeName
, "r");

75 ià(!
loÿtiÚFe
) {

76 
	`´štf
("CªnÙ o³ÀfÜ„—dšg: %s\n", 
loÿtiÚFeName
);

77 
	`ex™
(1);

79 
	`fg‘s
(
lšebuf
, Öšebuf), 
loÿtiÚFe
)) {

80 *
begš
 = &
lšebuf
[0];

81 (*
begš
 == ' ') || (*begin == '\r') || (*begin == '\n'))

82 
begš
++;

83 ià(*
begš
) {

84 
xPos
 = 
	`©oi
(
	`¡¹ok
(
begš
, "\t"));

85 
yPos
 = 
	`©oi
(
	`¡¹ok
(
NULL
, "\t"));

86 
zPos
 = 
	`©oi
(
	`¡¹ok
(
NULL
, "\t"));

88 
ssi_152
 = 
	`©of
(
	`¡¹ok
(
NULL
, "\t"));

89 
ssi_153
 = 
	`©of
(
	`¡¹ok
(
NULL
, "\t"));

90 
ssi_154
 = 
	`©of
(
	`¡¹ok
(
NULL
, "\t"));

91 
ssi_156
 = 
	`©of
(
	`¡¹ok
(
NULL
, "\t"));

92 
ssi_157
 = 
	`©of
(
	`¡¹ok
(
NULL
, "\t"));

93 
ssi_160
 = 
	`©of
(
	`¡¹ok
(
NULL
, "\t"));

94 cÚ¡ *
desütiÚ
 = 
	`¡¹ok
(
NULL
, "\r\n");

96 
š™_sigÇl
[0][
numLoÿtiÚs
] = 
ssi_152
;

97 
š™_sigÇl
[1][
numLoÿtiÚs
] = 
ssi_153
;

98 
š™_sigÇl
[2][
numLoÿtiÚs
] = 
ssi_154
;

99 
š™_sigÇl
[3][
numLoÿtiÚs
] = 
ssi_156
;

100 
š™_sigÇl
[4][
numLoÿtiÚs
] = 
ssi_157
;

101 
š™_sigÇl
[5][
numLoÿtiÚs
] = 
ssi_160
;

103 
loÿtiÚ
[
numLoÿtiÚs
++] = 
Ãw
 
	`loÿtiÚRecÜd
(
desütiÚ
,

104 
xPos
, 
yPos
, 
zPos
,

105 
ssi_152
, 
ssi_153
, 
ssi_154
, 
ssi_156
, 
ssi_157
, 
ssi_160
);

106 
loÿtiÚ
[
numLoÿtiÚs
 - 1]->
	`dump
();

108 ià(
numLoÿtiÚs
 >ğ
maxLoÿtiÚs
) {

109 
	`´štf
("MÜthª %d†oÿtiÚs\n", 
maxLoÿtiÚs
);

110 
	`ex™
(1);

114 
	`fşo£
(
loÿtiÚFe
);

117 ià(
­FeName
) {

118 
FILE
 *
­Fe
 = 
	`fİ’
(
­FeName
, "r");

119 ià(!
­Fe
) {

120 
	`´štf
("CªnÙ o³ÀfÜ„—dšg: %s\n", 
­FeName
);

121 
	`ex™
(1);

124 
	`fg‘s
(
lšebuf
, Öšebuf), 
­Fe
)) {

125 
	`¡¹ok
(
lšebuf
, "\r\n");

126 ià(
lšebuf
[0] && (linebuf[0]!='#') &&†inebuf[1] && (linebuf[2] == ':')) {

127 cÚ¡ *
bssidTextu®
 = 
	`¡¹ok
(
lšebuf
, " ");

128 cÚ¡ *
essid
 = 
	`¡¹ok
(
NULL
, "#");

130 
­
[
numAP
++] = 
Ãw
 
	`acûssPoštRecÜd
(
bssidTextu®
, 
essid
);

131 
­
[
numAP
 - 1]->
	`dump
();

133 ià(
numAP
 >ğ
maxAP
) {

134 
	`´štf
("MÜthª %d‡cûs pošts\n", 
maxAP
);

135 
	`ex™
(1);

140 
	`fşo£
(
­Fe
);

142 
	}
}

144 
	gsûÇrioDesütÜ
::
	$dump
()

146 
	`´štf
("Locations: ============================================\n");

147 
i
=0; i<
numLoÿtiÚs
; i++) {

148 
	`´štf
("%3d: ", 
i
);

149 
loÿtiÚ
[
i
]->
	`dump
();

151 
	`´štf
("Access…oints: ========================================\n");

152 
i
=0; i<
numAP
; i++) {

153 
	`´štf
("%3d: ", 
i
);

154 
­
[
i
]->
	`dump
();

156 
	}
}

158 
	gsûÇrioDesütÜ
::
	$ju¡g‘LoÿtiÚIndex
(
xPos
, 
yPos
, 
zPos
) {

160  
i
 = 0; i < 
numLoÿtiÚs
; i++)

161 ià(
loÿtiÚ
[
i
]->
	`isAt
(
xPos
, 
yPos
, 
zPos
))

162  
i
;

163 
	}
}

164 
	gsûÇrioDesütÜ
::
	$g‘LoùnIndex
(cÚ¡ *
loÿtiÚName
)

166 
i
=0; i<
numLoÿtiÚs
; i++)

167 ià(
loÿtiÚ
[
i
]->
	`loÿtiÚ_Çme_equ®s
(
loÿtiÚName
))

168  
i
;

169 
	}
}

171 
	gsûÇrioDesütÜ
::
	$g‘LoÿtiÚIndex
(cÚ¡ *
loÿtiÚName
, 
xPos
, 
yPos
, 
zPos
)

173 
i
=0; i<
numLoÿtiÚs
; i++)

174 ià(
loÿtiÚ
[
i
]->
	`equ®s
(
loÿtiÚName
, 
xPos
, 
yPos
, 
zPos
))

175  
i
;

177 ià(
isLocked
) {

178 
	`årštf
(
¡d”r
, "SûÇriØlocked: g‘LoÿtiÚIndex(%s, %d, %d, %d)\n", 
loÿtiÚName
, 
xPos
, 
yPos
, 
zPos
);

179 
	`ex™
(1);

182 
loÿtiÚ
[
numLoÿtiÚs
] = 
Ãw
 
	`loÿtiÚRecÜd
(
loÿtiÚName
, 
xPos
, 
yPos
, 
zPos
);

183 ià(
numLoÿtiÚs
 > 
maxLoÿtiÚs
) {

184 
	`årštf
(
¡d”r
, "ToØmªy†oÿtiÚs: %d\n", 
maxLoÿtiÚs
);

185 
	`ex™
(1);

188  
numLoÿtiÚs
++;

189 
	}
}

191 
	gsûÇrioDesütÜ
::
	$g‘LoÿtiÚIndex
(cÚ¡ *
loÿtiÚName
)

193 
i
=0; i<
numLoÿtiÚs
; i++)

194 ià(
loÿtiÚ
[
i
]->
	`desütiÚEqu®s
(
loÿtiÚName
))

195  
i
;

198 
	}
}

200 
	gsûÇrioDesütÜ
::
	$g‘LoÿtiÚIndex
(
loÿtiÚRecÜd
 *
loc
)

202 
i
=0; i<
numLoÿtiÚs
; i++)

203 ià(
loÿtiÚ
[
i
]->
	`equ®s
(
loc
))

204  
i
;

207 
	}
}

209 
	gsûÇrioDesütÜ
::
	$g‘SnifãrIndex
(cÚ¡ *
essid
)

211 
i
=0; i<
numAP
; i++)

212 ià(
­
[
i
]->
	`essid_equ®s
(
essid
))

213  
i
;

215 ià(!
essid
) {

216 
	`årštf
(
¡d”r
, "getApIndex called with wildcards, but AP‚ot found\n");

221 
	}
}

223 
	gsûÇrioDesütÜ
::
	$g‘ApIndex
(cÚ¡ *
bssid
, cÚ¡ *
essid
)

225 
i
=0; i<
numAP
; i++)

226 ià(
­
[
i
]->
	`equ®s
(
bssid
, 
essid
))

227  
i
;

229 ià(!
essid
) {

230 
	`årštf
(
¡d”r
, "g‘ApIndex c®Ëd w™h wdÿrds, buˆAP (%sènÙ found\n", 
bssid
);

235 
	}
}

237 
loÿtiÚRecÜd
 *
	gsûÇrioDesütÜ
::
	$g‘LoÿtiÚ
(
šdex
)

239 
	`as£¹
((0<=
šdex
è&& (šdex<
numLoÿtiÚs
));

240  
loÿtiÚ
[
šdex
];

241 
	}
}

243 
	gsûÇrioDesütÜ
::
	$g‘NumLoÿtiÚs
()

245  
numLoÿtiÚs
;

246 
	}
}

248 
	gsûÇrioDesütÜ
::
	$g‘NumAP
()

250  
numAP
;

251 
	}
}

253 
loÿtiÚRecÜd
 *
	gsûÇrioDesütÜ
::
	$fšdLoÿtiÚ
(
x
, 
y
, 
z
)

255 
i
=0; i<
numLoÿtiÚs
; i++)

256 ià(
loÿtiÚ
[
i
]->
	`isAt
(
x
, 
y
, 
z
))

257  
loÿtiÚ
[
i
];

258 
	`´štf
("NÙ found: %d %d %d\n", 
x
, 
y
, 
z
);

259 
	`ex™
(99);

260  
NULL
;

261 
	}
}

263 
acûssPoštRecÜd
 *
	gsûÇrioDesütÜ
::
	$g‘AP
(
šdex
)

265 
	`as£¹
((0<=
šdex
è&& (šdex<
numAP
));

266  
­
[
šdex
];

267 
	}
}

269 
	gsûÇrioDesütÜ
::
	$lock
()

271 
isLocked
 = 
Œue
;

272 
	}
}

274 
sûÇrioDesütÜ
 *
	gsûÇrioDesütÜ
::
	$şÚe
()

276 
sûÇrioDesütÜ
 *
³”
 = 
Ãw
 
	`sûÇrioDesütÜ
();

278 
i
=0; i<
numAP
; i++)

279 
³”
->
­
[
i
] =‡p[i]->
	`şÚe
();

280 
i
=0; i<
numLoÿtiÚs
; i++)

281 
³”
->
loÿtiÚ
[
i
] =†oÿtiÚ[i]->
	`şÚe
();

283 
³”
->
numAP
 =‚umAP;

284 
³”
->
numLoÿtiÚs
 =‚umLocations;

285 
³”
->
isLocked
 = isLocked;

287  
³”
;

288 
	}
}

290 
	gsûÇrioDesütÜ
::
	$»moveAP
(
­Index
)

292 
	`as£¹
((0<=
­Index
è&& (­Index<
numAP
));

294 
d–‘e
 
­
[
­Index
];

295 
i
=
­Index
; i<(
maxAP
-1); i++)

296 
­
[
i
] =‡p[i+1];

298 
numAP
 --;

299 
	}
}

	@librwl/stat.cc

49 
	~<¡dlib.h
>

50 
	~<¡dio.h
>

51 
	~<¡ršg.h
>

52 
	~<as£¹.h
>

54 
	~"ev®.h
"

56 
	gSti¡ics
::
	$Sti¡ics
()

58 
d©a
 = (*)
	`m®loc
(()*
g¿nuÏr™y
);

59 ià(!
d©a
) {

60 
	`årštf
(
¡d”r
, "Cannot‡llocate statistics buffer\n");

61 
	`ex™
(1);

63 
numV®ues
 = 0;

64 
maxV®ues
 = 
g¿nuÏr™y
;

65 
sÜ‹d
 = 
Œue
;

66 
	}
}

68 
	gSti¡ics
::
	$addV®ue
(
v®ue
)

70 ià(
numV®ues
 =ğ
maxV®ues
) {

71 *
d©a2
 = (*)
	`m®loc
(()*(
maxV®ues
+
g¿nuÏr™y
));

72 ià(!
d©a
) {

73 
	`årštf
(
¡d”r
, "Cannot‡llocate statistics buffer\n");

74 
	`ex™
(1);

76 
	`memıy
(
d©a2
, 
d©a
, ()*
numV®ues
);

77 
maxV®ues
 +ğ
g¿nuÏr™y
;

78 
	`ä“
(
d©a
);

79 
d©a
 = 
d©a2
;

82 
d©a
[
numV®ues
++] = 
v®ue
;

83 
sÜ‹d
 = 
çl£
;

84 
	}
}

86 
	gSti¡ics
::
	$sÜt
()

88 
i
=0; i<(
numV®ues
-1); i++) {

89 
be¡V®ue
 = 
d©a
[
i
];

90 
be¡Index
 = 
i
;

91 
j
=
i
+1; j<
numV®ues
; j++) {

92 ià(
d©a
[
j
]<
be¡V®ue
) {

93 
be¡V®ue
 = 
d©a
[
j
];

94 
be¡Index
 = 
j
;

97 ià(
be¡Index
 !ğ
i
) {

98 
h
 = 
d©a
[
be¡Index
];

99 
d©a
[
be¡Index
] = d©a[
i
];

100 
d©a
[
i
] = 
h
;

104 
sÜ‹d
 = 
Œue
;

105 
	}
}

107 
	gSti¡ics
::
	$numB‘w“n
(
x
, 
y
)

109 
i
 = 0, 
j
 = 0;

111 ià(!
sÜ‹d
)

112 
	`sÜt
();

114 (
i
<
numV®ues
è&& (
d©a
[i]<=
x
))

115 
i
++;

117 
j
 = 
i
;

119 (
j
<
numV®ues
è&& (
d©a
[j]<=
y
))

120 
j
++;

122  (
j
-
i
);

123 
	}
}

125 
	gSti¡ics
::
	$numSm®ËrThª
(
x
)

127 ià(!
sÜ‹d
)

128 
	`sÜt
();

130  
	`numB‘w“n
(
d©a
[0]-1, 
x
);

131 
	}
}

133 
	gSti¡ics
::
	$äaùiÚB‘w“n
(
x
, 
y
)

135 ià(
numV®ues
 < 1)

138  (()
	`numB‘w“n
(
x
, 
y
))/
numV®ues
;

139 
	}
}

141 
	gSti¡ics
::
	$äaùiÚSm®ËrThª
(
x
)

143 ià(
numV®ues
 < 1)

146  (()
	`numSm®ËrThª
(
x
))/
numV®ues
;

147 
	}
}

149 
	gSti¡ics
::
	$numTÙ®
()

151  
numV®ues
;

152 
	}
}

154 
	gSti¡ics
::
	$³rûÁe
(
n
)

156 ià(!
sÜ‹d
)

157 
	`sÜt
();

159 
	`as£¹
((0.0<
n
) && (n<1.0));

160 
šdex
 = ()(
n
 * 
numV®ues
);

162  
d©a
[
šdex
];

163 
	}
}

165 
	gSti¡ics
::
	$mšimum
()

167 ià(!
sÜ‹d
)

168 
	`sÜt
();

170  
d©a
[0];

171 
	}
}

173 
	gSti¡ics
::
	$maximum
()

175 ià(!
sÜ‹d
)

176 
	`sÜt
();

178  
d©a
[
numV®ues
-1];

179 
	}
}

181 
	gSti¡ics
::
	$av”age
()

183 
»suÉ
 = 0;

185 ià(!
numV®ues
)

188 
i
=0; i<
numV®ues
; i++)

189 
»suÉ
 +ğ
d©a
[
i
];

191  
»suÉ
 / 
numV®ues
;

192 
	}
}

	@librwl/topology.cc

49 
	~<¡dlib.h
>

50 
	~<¡dio.h
>

51 
	~<as£¹.h
>

53 
	~"ev®.h
"

55 
	gTİŞogyMod–
::
	$TİŞogyMod–
(
sûÇrioDesütÜ
 *
sûÇrio
, cÚ¡ *
ÃighbourFe
, cÚ¡ *
§meRoomFe
)

57 
this
->
sûÇrio
 = scenario;

59 
i
=0; i<
maxLoÿtiÚs
; i++) {

60 
numNeighbours
[
i
] = 0;

61 
numInSameRoom
[
i
] = 0;

64 
FILE
 *
f
 = 
	`fİ’
(
ÃighbourFe
, "r");

65 ià(!
f
) {

66 
	`årštf
(
¡d”r
, "CªnÙ o³ÀÃighbou¸ffÜ„—dšg: %s\n", 
ÃighbourFe
);

67 
	`ex™
(1);

70 
lšebuf
[200];

71 
cu¼’tLoÿtiÚ
 = -1;

73 !
	`ãof
(
f
)) {

75 
	`fg‘s
(
lšebuf
, Öšebuf), 
f
);

76 
	`¡¹ok
(
lšebuf
, "\r\n");

77 } !
lšebuf
[0] && !
	`ãof
(
f
));

79 ià(
	`ãof
(
f
))

82 ià(!
	`¡ºcmp
(
lšebuf
, " - ", 4)) {

83 ià(
cu¼’tLoÿtiÚ
 == -1)

84 
	`·nic
("Neighbour file formatƒrror: Neighbour†isted, but‚o†ocation defined!");

86 
thisNeighbour
 = 
sûÇrio
->
	`g‘LoÿtiÚIndex
(&
lšebuf
[4]);

87 ià(
thisNeighbour
 == -1)

88 
	`·nic
("Neighbou¸nÙ found: %s", &
lšebuf
[4]);

89 ià(
numNeighbours
[
cu¼’tLoÿtiÚ
] =ğ
maxNeighbours
)

90 
	`·nic
("ToØmªy‚eighbour fÜ %s", 
sûÇrio
->
	`g‘LoÿtiÚ
(
cu¼’tLoÿtiÚ
)->
	`»nd”
(
lšebuf
));

91 
i
=0; i<
numNeighbours
[
cu¼’tLoÿtiÚ
]; i++)

92 ià(
Ãighbour
[
cu¼’tLoÿtiÚ
][
i
] =ğ
thisNeighbour
)

93 
	`·nic
("Du¶iÿ‹‚eighbour: %s", 
lšebuf
);

94 ià(
thisNeighbour
 =ğ
cu¼’tLoÿtiÚ
)

95 
	`·nic
("% ÿÂÙ b™ owÀÃighbour", 
lšebuf
);

96 
Ãighbour
[
cu¼’tLoÿtiÚ
][
numNeighbours
[cu¼’tLoÿtiÚ]++] = 
thisNeighbour
;

98 
cu¼’tLoÿtiÚ
 = 
sûÇrio
->
	`g‘LoÿtiÚIndex
(
lšebuf
);

99 ià(
cu¼’tLoÿtiÚ
 == -1)

100 
	`·nic
("LoÿtiÚ‚Ù found: %s", 
lšebuf
);

104 
	`fşo£
(
f
);

106 ià(
§meRoomFe
 !ğ
NULL
) {

107 
f
 = 
	`fİ’
(
§meRoomFe
, "r");

108 ià(!
f
) {

109 
	`årštf
(
¡d”r
, "CªnÙ o³À§mroom ffÜ„—dšg: %s\n", 
§meRoomFe
);

110 
	`ex™
(1);

113 
cu¼’tLoÿtiÚ
 = -1;

114 !
	`ãof
(
f
)) {

116 
	`fg‘s
(
lšebuf
, Öšebuf), 
f
);

117 
	`¡¹ok
(
lšebuf
, "\r\n");

118 } !
lšebuf
[0] && !
	`ãof
(
f
));

120 ià(
	`ãof
(
f
))

123 ià(!
	`¡ºcmp
(
lšebuf
, " - ", 4)) {

124 ià(
cu¼’tLoÿtiÚ
 == -1)

125 
	`·nic
("Same„oom file formatƒrror: Neighbour†isted, but‚o†ocation defined!");

127 
thisNeighbour
 = 
sûÇrio
->
	`g‘LoÿtiÚIndex
(&
lšebuf
[4]);

128 ià(
thisNeighbour
 == -1)

129 
	`·nic
("Neighbou¸nÙ found: %s", &
lšebuf
[4]);

130 ià(
numInSameRoom
[
cu¼’tLoÿtiÚ
] =ğ
maxInSameRoom
)

131 
	`·nic
("ToØmªy‚eighbour fÜ %s", 
sûÇrio
->
	`g‘LoÿtiÚ
(
cu¼’tLoÿtiÚ
)->
	`»nd”
(
lšebuf
));

132 
i
=0; i<
numInSameRoom
[
cu¼’tLoÿtiÚ
]; i++)

133 ià(
§meRoom
[
cu¼’tLoÿtiÚ
][
i
] =ğ
thisNeighbour
)

134 
	`·nic
("Du¶iÿ‹‚eighbour: %s", 
lšebuf
);

135 ià(
thisNeighbour
 =ğ
cu¼’tLoÿtiÚ
)

136 
	`·nic
("% ÿÂÙ b™ owÀÃighbour", 
lšebuf
);

137 
§meRoom
[
cu¼’tLoÿtiÚ
][
numInSameRoom
[cu¼’tLoÿtiÚ]++] = 
thisNeighbour
;

139 
cu¼’tLoÿtiÚ
 = 
sûÇrio
->
	`g‘LoÿtiÚIndex
(
lšebuf
);

140 ià(
cu¼’tLoÿtiÚ
 == -1)

141 
	`·nic
("LoÿtiÚ‚Ù found: %s", 
lšebuf
);

145 
	`fşo£
(
f
);

147 
	}
}

149 
	gTİŞogyMod–
::
	$g‘NumNeighbours
(
loÿtiÚIndex
)

151  
numNeighbours
[
loÿtiÚIndex
];

152 
	}
}

154 
	gTİŞogyMod–
::
	$g‘Neighbour
(
loÿtiÚIndex
, 
ÃighbourIndex
)

156 
	`as£¹
((
loÿtiÚIndex
>=0è&& (loÿtiÚIndex<
maxLoÿtiÚs
));

157 
	`as£¹
((
ÃighbourIndex
>=0è&& (ÃighbourIndex<
numNeighbours
[
loÿtiÚIndex
]));

159  
Ãighbour
[
loÿtiÚIndex
][
ÃighbourIndex
];

160 
	}
}

162 
	gTİŞogyMod–
::
	$addNeighbour
(
loÿtiÚIndex
, 
ÃighbourIndex
)

164 
	`as£¹
((
loÿtiÚIndex
>=0è&& (loÿtiÚIndex<
maxLoÿtiÚs
));

165 
	`as£¹
((
ÃighbourIndex
>=0è&& (ÃighbourIndex<
maxLoÿtiÚs
));

167 ià(
numNeighbours
[
loÿtiÚIndex
] =ğ
maxNeighbours
)

168 
	`·nic
("ToØmªy‚eighbour fÜ %d", 
loÿtiÚIndex
);

170 
Ãighbour
[
loÿtiÚIndex
][
numNeighbours
[loÿtiÚIndex]++] = 
ÃighbourIndex
;

171 
	}
}

173 
	gTİŞogyMod–
::
	$wr™eTo
(cÚ¡ *
ÃighbourFe
)

175 
FILE
 *
f
 = 
	`fİ’
(
ÃighbourFe
, "w+");

176 
buf
[256];

178 ià(!
f
) {

179 
	`årštf
(
¡d”r
, "CªnÙ o³ÀÃighbou¸ffÜ wr™šg: %s\n", 
ÃighbourFe
);

180 
	`ex™
(1);

183 
i
=0; i<
maxLoÿtiÚs
; i++) {

184 ià(
numNeighbours
[
i
]>0) {

185 
	`årštf
(
f
, "%s\n", 
sûÇrio
->
	`g‘LoÿtiÚ
(
i
)->
	`»nd”
(
buf
));

186 
j
=0; j<
numNeighbours
[
i
]; j++)

187 
	`årštf
(
f
, " - %s\n", 
sûÇrio
->
	`g‘LoÿtiÚ
(
Ãighbour
[
i
][
j
])->
	`»nd”
(
buf
));

191 
	`fşo£
(
f
);

192 
	}
}

194 
boŞ
 
	gTİŞogyMod–
::
	$isNeighbourOf
(
loÿtiÚA
, 
loÿtiÚB
)

196 
	`as£¹
((
loÿtiÚA
>=0è&& (loÿtiÚA<
maxLoÿtiÚs
));

198 
i
=0; i<
numNeighbours
[
loÿtiÚA
]; i++)

199 ià(
Ãighbour
[
loÿtiÚA
][
i
] =ğ
loÿtiÚB
)

200  
Œue
;

202  
çl£
;

203 
	}
}

205 
boŞ
 
	gTİŞogyMod–
::
	$šSameRoom
(
loÿtiÚA
, 
loÿtiÚB
)

207 ià(
loÿtiÚA
 =ğ
loÿtiÚB
)

208  
Œue
;

210 
	`as£¹
((
loÿtiÚA
>=0è&& (loÿtiÚA<
maxLoÿtiÚs
));

212 
i
=0; i<
numInSameRoom
[
loÿtiÚA
]; i++)

213 ià(
§meRoom
[
loÿtiÚA
][
i
] =ğ
loÿtiÚB
)

214  
Œue
;

216  
çl£
;

217 
	}
}

	@librwl/training.cc

49 
	~<¡dlib.h
>

50 
	~<¡dio.h
>

51 
	~<¡ršg.h
>

52 
	~<as£¹.h
>

53 
	~<dœ’t.h
>

54 
	~<sys/¡©.h
>

55 
	~"ev®.h
"

57 
	#d´štf
(
a
...)

	)

59 
	gŒaššgD©aPackage
::
	$ŒaššgD©aPackage
()

61 
this
->
numOb£rv©iÚs
 = 0;

62 
this
->
sûÇrio
 = 
Ãw
 
	`sûÇrioDesütÜ
();

63 
	}
}

65 
	gŒaššgD©aPackage
::
	$ŒaššgD©aPackage
(cÚ¡ *
¶aûFeName
, cÚ¡ *
­FeName
)

67 
this
->
numOb£rv©iÚs
 = 0;

68 
this
->
sûÇrio
 = 
Ãw
 
	`sûÇrioDesütÜ
(
¶aûFeName
, 
­FeName
);

69 
	}
}

71 
boŞ
 
	gŒaššgD©aPackage
::
	$»adNewFe
(cÚ¡ *
feName
)

73 
¡©
 
¡©buf
;

74 
lšebuf
[200];

75 
­Id
, 
i
 ;

76 
sigÇl
;

78 
	`´štf
("\n***11***---------------%s\n", 
feName
);

79 
	`fæush
(
¡dout
);

81 ià(
	`¡©
(
feName
, &
¡©buf
)<0)

82  
çl£
;

84 ià(
	`S_ISDIR
(
¡©buf
.
¡_mode
)) {

85 
	`´štf
("% i ¨dœeùÜy\n", 
feName
);

86  
çl£
;

89 
	`´štf
("\n***12***\n");

90 
	`fæush
(
¡dout
);

92 
FILE
 *
f
 = 
	`fİ’
(
feName
, "r");

93 ià(!
f
) {

94 
	`årštf
(
¡d”r
, "CªnÙ o³ÀfÜ„—dšg: %s\n", 
feName
);

95  
çl£
;

98 
	`´štf
("\n***13***\n");

99 
	`fæush
(
¡dout
);

101 
	`mem£t
(
lšebuf
, 0, (linebuf));

102 
	`¡rıy
(
lšebuf
, 
feName
);

104 
	`¡¹ok
(
lšebuf
, "/");

105 
­Id
 = 
	`©oi
 (
	`¡¹ok
(
NULL
, "\0"));

110 
	`´štf
("\n-------------->>>>>>>>>>>>***16.5 ***‡pId=%d \n", 
­Id
);

153  
i
 = 0; i < 
numOb£rv©iÚs
; i++ ) {

154 ià(
ob£rv©iÚ
[
i
].
locId
 ==†ocId) {

155 
	`´štf
("GÙ it!‚umOb ğ%d : i=%d :hisAp=%d\n",
numOb£rv©iÚs
, 
i
, 
­Id
);

160 
	`´štf
("\n***19 ---i=%d ***\n", 
i
);

161 
	`fæush
(
¡dout
);

163  
k
 = 0; k < 
NUM_OBSERVATIONS
; k++)

164 
loÿtiÚIndex
[
i
 + 
k
] = 
locId
;

166  
k
 = 0; k < 
NUM_OBSERVATIONS
; k++) {

167 
	`mem£t
(
lšebuf
, 0, (linebuf));

168 
	`fg‘s
(
lšebuf
, Öšebuf), 
f
);

169 ià(
	`ãof
(
f
))

172 
sigÇl
 = 
	`©oi
(
lšebuf
);

173 
ob£rv©iÚ
[
k
].
sœ
[
­Id
] = 
sigÇl
;

176 
	`´štf
("\n***20***\n");

177 
	`fæush
(
¡dout
);

179 
	`fşo£
(
f
);

180  
Œue
;

181 
	}
}

183 
boŞ
 
	gŒaššgD©aPackage
::
	$»adFe
(cÚ¡ *
feName
, 
ob£rv©iÚRecÜd
 *
o
, *
loÿtiÚ
)

185 
¡©
 
¡©buf
;

186 
lšebuf
[200];

187 
i
;

189 ià(
	`¡©
(
feName
, &
¡©buf
)<0)

190  
çl£
;

192 ià(
	`S_ISDIR
(
¡©buf
.
¡_mode
)) {

193 
	`´štf
("% i ¨dœeùÜy\n", 
feName
);

194  
çl£
;

197 
FILE
 *
f
 = 
	`fİ’
(
feName
, "r");

198 ià(!
f
) {

199 
	`årštf
(
¡d”r
, "CªnÙ o³ÀfÜ„—dšg: %s\n", 
feName
);

200  
çl£
;

204 
	`fg‘s
(
lšebuf
, Öšebuf), 
f
);

205 } 
	`¡rcmp
(
lšebuf
, "[position]\n"));

207 
desütiÚ
[100];

208 
	`fg‘s
(
desütiÚ
, (desütiÚ), 
f
);

209 
	`¡¹ok
(
desütiÚ
, "\n");

210 ià(
	`¡rcmp
(
desütiÚ
, "Unknown")) {

211 
	`fg‘s
(
lšebuf
, Öšebuf), 
f
);

212 
xPos
 = 
	`©oi
(
	`¡¹ok
(
lšebuf
, " "));

213 
yPos
 = 
	`©oi
(
	`¡¹ok
(
NULL
, " "));

214 
zPos
 = 
	`©oi
(
	`¡¹ok
(
NULL
, " "));

216 *
loÿtiÚ
 = 
sûÇrio
->
	`g‘LoÿtiÚIndex
(
desütiÚ
, 
xPos
, 
yPos
, 
zPos
);

218 *
loÿtiÚ
 = -1;

221 
o
->
	`z”o
();

224 
	`fg‘s
(
lšebuf
, Öšebuf), 
f
);

225 } 
	`¡rcmp
(
lšebuf
, "[stations]\n"));

228 
	`fg‘s
(
lšebuf
, Öšebuf), 
f
);

229 ià((
lšebuf
[0]!='B'è|| 
	`ãof
(
f
))

231 
	`¡¹ok
(
lšebuf
, "=");

232 *
bssid
 = 
	`¡¹ok
(
NULL
, " ");

233 
	`¡¹ok
(
NULL
, "=");

234 
äeq
 = 
	`©oi
(
	`¡¹ok
(
NULL
, " "));

235 
	`¡¹ok
(
NULL
, "=");

236 
mode
 = 
	`©oi
(
	`¡¹ok
(
NULL
, " "));

237 
	`¡¹ok
(
NULL
, "=");

238 
sœ
 = 
	`©oi
(
	`¡¹ok
(
NULL
, " "));

239 
	`¡¹ok
(
NULL
, "=");

240 
¢r
 = 
	`©oi
(
	`¡¹ok
(
NULL
, " "));

241 
	`¡¹ok
(
NULL
, "=");

242 *
essid
 = 
	`¡¹ok
(
NULL
, "\r\n");

244 ià(
mode
 != 3) {

245 
	`d´štf
("UnknowÀmodš %s: %d\n", 
feName
, 
mode
);

248 
thisAP
 = 
sûÇrio
->
	`g‘ApIndex
(
bssid
, 
essid
);

249 ià(
thisAP
>=0) {

250 
o
->
sœ
[
thisAP
] = sir;

251 
o
->
¢r
[
thisAP
] = snr;

253 
	`d´štf
("IgnÜšg AP %s, ESSID %s\n", 
bssid
, 
essid
);

257 
	`fşo£
(
f
);

259  
Œue
;

260 
	}
}

262 
	gŒaššgD©aPackage
::
	$addT¿ššgDœeùÜy
(cÚ¡ *
dœeùÜyName
)

264 
dœ’t
 *
’Œy1
, *
’Œy2
, *
’Œy3
;

265 
DIR
 *
sÿnFeDœ1
, *
sÿnFeDœ2
, *
sÿnFeDœ3
 ;

266 
¢ifãrId
;

267 
feName1
[200], 
feName2
[200], 
feName3
[200];

268 
out_fe
[100];

270 ià(!(
sÿnFeDœ1
 = 
	`İ’dœ
(
dœeùÜyName
))) {

271 
	`´štf
("CªnÙ o³ÀT¿ššg dœeùÜy fÜ„—dšg: %s\n", 
dœeùÜyName
);

272 
	`ex™
(1);

275 
	`´štf
("\n***6***\n");

276 
	`fæush
(
¡dout
);

278 
’Œy1
 = 
	`»addœ
(
sÿnFeDœ1
)) {

279 ià(
	`¡rcmp
(
’Œy1
->
d_Çme
, ".") && strcmp(entry1->d_name, "..")) {

281 
¢ifãrId
 = 
sûÇrio
->
	`g‘SnifãrIndex
(
’Œy1
->
d_Çme
);

282 
	`mem£t
Ğ
feName1
, 0, (fileName1));

283 
	`¥rštf
(
feName1
, "%s/%s", 
dœeùÜyName
, 
’Œy1
->
d_Çme
);

285 
	`´štf
("%s/% ¢ifãrId:%d", 
dœeùÜyName
, 
’Œy1
->
d_Çme
, 
¢ifãrId
);

287 iàĞ!Ğ
sÿnFeDœ2
 = 
	`İ’dœ
(
feName1
))) {

288 
	`´štf
("CªnÙ o³À¢ifã¸dœeùÜy fÜ„—dšg: %s\n", 
feName1
);

289 
	`ex™
(1);

291 
	`¥rštf
Ğ
out_fe
, "Sÿns/%d", 
¢ifãrId
);

293 
’Œy2
 = 
	`»addœ
(
sÿnFeDœ2
)) {

294 ià(
	`¡rcmp
(
’Œy2
->
d_Çme
, ".") && strcmp(entry2->d_name, "..")) {

295 
	`mem£t
Ğ
feName2
, 0, (fileName2));

296 
	`¥rštf
(
feName2
, "%s/%s", 
feName1
, 
’Œy2
->
d_Çme
);

297 
	`´štf
("--- f’ame:%s\n",
feName2
);

298 
	`tsh¬k_·r£Fe
(
feName2
, 
out_fe
);

301 
	`şo£dœ
(
sÿnFeDœ2
);

302 
	`addFe
(
out_fe
);

305 
	`şo£dœ
(
sÿnFeDœ1
);

306 
	}
}

309 
	gloùnId
 = 
sûÇrio
->
g‘LoùnIndex
(
’Œy2
->
d_Çme
);

310 
mem£t
Ğ
feName2
, 0, (fileName2));

311 
¥rštf
(
feName2
, "%s/%s", 
feName1
, 
’Œy2
->
d_Çme
);

312 
´štf
("¢ifãrId:%d†oùnId:%d…©hÇme:%s\n",
¢ifãrId
, 
loùnId
, 
feName2
);

314 iàĞ!Ğ
	gsÿnFeDœ3
 = 
	$İ’dœ
(
feName2
))) {

315 
	`´štf
("CªnÙ o³ÀloÿtiÚ dœeùÜy fÜ„—dšg: %s\n", 
feName2
);

316 
	`ex™
(1);

317 
	}
}

318 
¥rštf
Ğ
out_fe
, "Sÿns/%d.%d", 
¢ifãrId
, 
loùnId
);

319 
	g’Œy3
 = 
	$»addœ
(
sÿnFeDœ3
)) {

320 ià(
	`¡rcmp
(
’Œy3
->
d_Çme
, ".") && strcmp(entry3->d_name, "..")) {

321 
	`mem£t
Ğ
feName3
, 0, (fileName3));

322 
	`¥rštf
(
feName3
, "%s/%s", 
feName2
, 
’Œy3
->
d_Çme
);

323 
	`´štf
("--- f’ame:%s\n",
feName3
);

324 
	`tsh¬k_·r£Fe
(
feName3
, 
out_fe
);

326 
	}
}

327 
şo£dœ
(
sÿnFeDœ3
);

328 
addFe
(
out_fe
);

331 
şo£dœ
(
sÿnFeDœ2
);

334 
şo£dœ
(
sÿnFeDœ1
);

339 
	gŒaššgD©aPackage
::
	$tsh¬k_·r£Fe
(cÚ¡ *
feName
, cÚ¡ *
out_fe
)

341 
	`´štf
("lßdšg %s\n", 
feName
);

343 
lšebuff
[256], *
tmp
; 
sigÇl
;

344 
commªd
[100];

345 *
·r£d_f’ame
 = "tmp_parsed";

347 
	`¥rštf
Ğ
commªd
, "tsh¬k -V¸% > %s", 
feName
, 
·r£d_f’ame
);

348 
	`sy¡em
(
commªd
);

350 
FILE
 *
šput
 = 
	`fİ’
(
·r£d_f’ame
,"r");

351 ià(!
šput
) {

352 
	`´štf
("Cannot opensharkrace file \n");

356 
FILE
 *
ouut
 = 
	`fİ’
(
out_fe
,"a");

357 ià(!
ouut
) {

358 
	`´štf
("Cannot create output file \n");

362 !
	`ãof
(
šput
)) {

363 
	`mem£t
(
lšebuff
, 0, (linebuff));

364 
	`fg‘s
(
lšebuff
, Öšebuff), 
šput
);

365 ià(!
	`¡r¡r
(
lšebuff
,"SSI Signal:"))

368 
	`¡¹ok
(
lšebuff
,":");

369 
tmp
 = 
	`¡¹ok
(
NULL
," ");

370 
sigÇl
 = 
	`©oi
(
tmp
);

372 
	`årštf
(
ouut
,"%d\n", 
sigÇl
);

377 
	`fşo£
(
šput
);

378 
	`fşo£
(
ouut
);

379 
	`»move
(
·r£d_f’ame
);

381 
	}
}

383 
	gŒaššgD©aPackage
::
	$addDœeùÜy
(cÚ¡ *
dœeùÜyName
)

385 
dœ’t
 *
’Œy
;

386 
DIR
 *
sÿnFeDœ
;

388 ià(!(
sÿnFeDœ
 = 
	`İ’dœ
(
dœeùÜyName
))) {

389 
	`´štf
("CªnÙ o³ÀdœeùÜy fÜ„—dšg: %s\n", 
dœeùÜyName
);

390 
	`ex™
(1);

393 
	`´štf
("\n***6***\n");

394 
	`fæush
(
¡dout
);

396 
’Œy
 = 
	`»addœ
(
sÿnFeDœ
)) {

397 ià(
	`¡rcmp
(
’Œy
->
d_Çme
, ".") && strcmp(entry->d_name, "..")) {

398 
feName
[200];

399 
	`¥rštf
(
feName
, "%s/%s", 
dœeùÜyName
, 
’Œy
->
d_Çme
);

401 
	`´štf
("\n***7*** f’ame: %s\n",
feName
);

402 
	`fæush
(
¡dout
);

403 
	`addFe
(
feName
);

404 
	`´štf
("\n***8***\n");

405 
	`fæush
(
¡dout
);

409 
	`şo£dœ
(
sÿnFeDœ
);

410 
	}
}

412 
	gŒaššgD©aPackage
::
	$­¶yCÜ»ùive
(
a
, 
b
, 
c
)

414 
i
=0; i<
numOb£rv©iÚs
; i++)

415 
ob£rv©iÚ
[
i
].
	`­¶yCÜ»ùive
(
a
, 
b
, 
c
);

416 
	}
}

418 
	gŒaššgD©aPackage
::
	$addFe
(cÚ¡ *
feName
)

420 
	`d´štf
("lßdšg %s\n", 
feName
);

422 
	`´štf
("\n***9***\n");

423 
	`fæush
(
¡dout
);

424 
	`»adNewFe
(
feName
);

428 
	`´štf
("\n***10***\n");

429 
	`fæush
(
¡dout
);

430 ià(
numOb£rv©iÚs
 >ğ
maxOb£rv©iÚs
) {

431 
	`´štf
("ToØmuch¿ššg d©a: %d„ecÜds\n", 
maxOb£rv©iÚs
);

432 
	`ex™
(1);

434 
	}
}

436 
	gŒaššgD©aPackage
::
	$dump
()

438 
bufãr
[256];

440 
sûÇrio
->
	`dump
();

441 
i
=0; i<
numOb£rv©iÚs
; i++) {

442 
	`´štf
("Ob£rv©iÚ #%d‡ˆ%s:\n", 
i
, 
sûÇrio
->
	`g‘LoÿtiÚ
(
loÿtiÚIndex
[i])->
	`»nd”
(
bufãr
));

443 
ob£rv©iÚ
[
i
].
	`dump
();

445 
	}
}

447 
	gŒaššgD©aPackage
::
	$sw­Ob£rv©iÚs
(
i
, 
j
)

449 
	`as£¹
((0<=
i
è&& (i<=
numOb£rv©iÚs
));

450 
	`as£¹
((0<=
j
è&& (j<=
numOb£rv©iÚs
));

452 
ob£rv©iÚRecÜd
 
hO
;

453 
hL
;

455 
hO
 = 
ob£rv©iÚ
[
i
];

456 
ob£rv©iÚ
[
i
] = ob£rv©iÚ[
j
];

457 
ob£rv©iÚ
[
j
] = 
hO
;

459 
hL
 = 
loÿtiÚIndex
[
i
];

460 
loÿtiÚIndex
[
i
] =†oÿtiÚIndex[
j
];

461 
loÿtiÚIndex
[
j
] = 
hL
;

462 
	}
}

464 
	gŒaššgD©aPackage
::
	$·tchIncom¶‘eOb£rv©iÚs
()

466 
ob£rv©iÚRecÜd
 
avg
[
MAX_LOCATIONS
];

467 
i
=0; i<
MAX_LOCATIONS
; i++)

468 
avg
[
i
].
	`z”o
();

470 
i
=0; i<
numOb£rv©iÚs
; i++) {

471 
j
=0; j<
sûÇrio
->
	`g‘NumAP
(); j++) {

472 ià(
ob£rv©iÚ
[
i
].
sœ
[
j
]) {

473 
avg
[
loÿtiÚIndex
[
i
]].
sœ
[
j
] +ğ
ob£rv©iÚ
[i].sir[j];

474 
avg
[
loÿtiÚIndex
[
i
]].
¢r
[
j
] ++;

479 
i
=0; i<
numOb£rv©iÚs
; i++) {

480 
j
=0; j<
sûÇrio
->
	`g‘NumAP
(); j++) {

481 ià((
ob£rv©iÚ
[
i
].
sœ
[
j
] =ğ0è&& (
avg
[
loÿtiÚIndex
[i]].
¢r
[j]>0))

482 
ob£rv©iÚ
[
i
].
sœ
[
j
] = 
avg
[
loÿtiÚIndex
[i]].sœ[j]/avg[loÿtiÚIndex[i]].
¢r
[j];

485 
	}
}

487 
loÿtiÚRecÜd
 *
	gŒaššgD©aPackage
::
	$fšdAP
(
­Index
)

489 
be¡SIR
 = 0, 
be¡LoÿtiÚ
 = 0;

491 
	`as£¹
((
­Index
>=0è&& (­Index<
MAX_AP
));

492 
i
=0; i<
numOb£rv©iÚs
; i++) {

493 ià(
ob£rv©iÚ
[
i
].
sœ
[
­Index
] > 
be¡SIR
) {

494 
be¡SIR
 = 
ob£rv©iÚ
[
i
].
sœ
[
­Index
];

495 
be¡LoÿtiÚ
 = 
loÿtiÚIndex
[
i
];

499  
sûÇrio
->
	`g‘LoÿtiÚ
(
be¡LoÿtiÚ
);

500 
	}
}

502 
	gŒaššgD©aPackage
::
	$numOb£rv©iÚsAtLoÿtiÚ
(
šdex
)

504 
»suÉ
 = 0;

506 
i
=0; i<
numOb£rv©iÚs
; i++)

507 ià(
loÿtiÚIndex
[
i
] =ğ
šdex
)

508 
»suÉ
 ++;

510  
»suÉ
;

511 
	}
}

513 
ob£rv©iÚRecÜd
 
	gŒaššgD©aPackage
::
	$»moveOb£rv©iÚ
(
šdex
)

515 
	`as£¹
((
šdex
>=0è&& (šdex<
numOb£rv©iÚs
));

517 
ob£rv©iÚRecÜd
 
»suÉ
 = 
ob£rv©iÚ
[
šdex
];

518 
i
=
šdex
; i<(
numOb£rv©iÚs
-1); i++) {

519 
ob£rv©iÚ
[
i
] = observation[i+1];

520 
loÿtiÚIndex
[
i
] =†ocationIndex[i+1];

523 
numOb£rv©iÚs
--;

524  
»suÉ
;

525 
	}
}

527 
	gŒaššgD©aPackage
::
	$fœ¡Ob£rv©iÚAt
(
šdex
)

529 
i
=0; i<
numOb£rv©iÚs
; i++)

530 ià(
loÿtiÚIndex
[
i
] =ğ
šdex
)

531  
i
;

534 
	}
}

536 
ŒaššgD©aPackage
 *
	gŒaššgD©aPackage
::
	$şÚe
()

538 
ŒaššgD©aPackage
 *
³”
 = 
Ãw
 
	`ŒaššgD©aPackage
();

540 
i
=0; i<
numOb£rv©iÚs
; i++) {

541 
³”
->
ob£rv©iÚ
[
i
] = observation[i];

542 
³”
->
loÿtiÚIndex
[
i
] =†ocationIndex[i];

545 
³”
->
numOb£rv©iÚs
 =‚umObservations;

546 
³”
->
sûÇrio
 = sûÇrio->
	`şÚe
();

548  
³”
;

549 
	}
}

551 
	gŒaššgD©aPackage
::
	$wr™eOb£rv©iÚsTo
(cÚ¡ *
feName
)

553 
numAP
 = 
sûÇrio
->
	`g‘NumAP
();

554 
FILE
 *
f
 = 
	`fİ’
(
feName
, "w+");

556 ià(!
f
)

557 
	`·nic
("CªnÙ o³ÀfÜ wr™šg: %s", 
feName
);

559 
	`årštf
(
f
, "%d\n", 
numOb£rv©iÚs
);

560 
i
=0; i<
numOb£rv©iÚs
; i++) {

561 
	`årštf
(
f
, "%d", 
loÿtiÚIndex
[
i
]);

562 
j
=0; j<
numAP
; j++)

563 
	`årštf
(
f
, " %d", 
ob£rv©iÚ
[
i
].
sœ
[
j
]);

565 
	`årštf
(
f
, "\n");

568 
	`fşo£
(
f
);

569 
	}
}

571 
	gŒaššgD©aPackage
::
	$»adOb£rv©iÚsFrom
(cÚ¡ *
feName
, 
M
)

573 
FILE
 *
f
 = 
	`fİ’
(
feName
, "r");

574 
lšebuf
[256];

576 ià(!
f
)

577 
	`·nic
("CªnÙ o³ÀfÜ„—dšg: %s", 
feName
);

579 
	`fg‘s
(
lšebuf
, Öšebuf)-1, 
f
);

581 
numOb£rv©iÚs
 = 
M
;

582 
	`´štf
("NØoàob£rv©iÚ tØ»ad from f%s: %d (max %d)\n", 
feName
, 
numOb£rv©iÚs
, 
maxOb£rv©iÚs
);

584 ià(
numOb£rv©iÚs
 > 
maxOb£rv©iÚs
)

585 
	`·nic
("ToØmªy ob£rv©iÚ š f%s: %d (max %d)", 
feName
, 
numOb£rv©iÚs
, 
maxOb£rv©iÚs
);

587 
i
 = 0; i < 
numOb£rv©iÚs
; i++) {

589 
ob£rv©iÚ
[
i
].
	`z”o
();

590 
	`mem£t
(
lšebuf
, 0, (linebuf));

591 
	`fg‘s
(
lšebuf
, Öšebuf)-1, 
f
);

593 *
s
 = 
	`¡¹ok
(
lšebuf
, " ");

594 
­Index
 = 0;

596 
loÿtiÚIndex
[
i
] = 
	`©oi
(
s
);

597 
s
 = 
	`¡¹ok
(
NULL
, " ");

598 
s
) {

599 
ob£rv©iÚ
[
i
].
sœ
[
­Index
] = 
	`©oi
(
s
);

600 
ob£rv©iÚ
[
i
].
¢r
[
­Index
] = 97;

601 
­Index
 ++;

602 ià(
­Index
 =ğ
MAX_AP
)

603 
	`·nic
("ToØmªy‡cûs pošt š %s", 
feName
);

605 
s
 = 
	`¡¹ok
(
NULL
, " ");

607 
ob£rv©iÚ
[
i
].
	`dump
();

609 
	`fşo£
(
f
);

610 
	}
}

612 
	gŒaššgD©aPackage
::
	$lim™Ob£rv©iÚsP”LoÿtiÚ
(
lim™
)

614 
fœ¡Ob£rv©iÚAt
[
MAX_LOCATIONS
];

615 
numOb£rv©iÚsAt
[
MAX_LOCATIONS
];

616 *
ÃxtRecÜd
;

617 
boŞ
 *
m¬ked
;

619 
m¬ked
 = (
boŞ
*)
	`m®loc
(
MAX_OBSERVATIONS
 * (bool));

620 ià(!
m¬ked
)

621 
	`·nic
("Out of memory while‡llocating marker field");

622 
ÃxtRecÜd
 = (*)
	`m®loc
(
MAX_OBSERVATIONS
 * ());

623 ià(!
ÃxtRecÜd
)

624 
	`·nic
("Out of memory while‡llocating chain field");

626 
i
=0; i<
MAX_LOCATIONS
; i++) {

627 
fœ¡Ob£rv©iÚAt
[
i
] = -1;

628 
numOb£rv©iÚsAt
[
i
] = 0;

630 
i
=0; i<
numOb£rv©iÚs
; i++) {

631 
ÃxtRecÜd
[
i
] = 
fœ¡Ob£rv©iÚAt
[
loÿtiÚIndex
[i]];

632 
fœ¡Ob£rv©iÚAt
[
loÿtiÚIndex
[
i
]] = i;

633 
numOb£rv©iÚsAt
[
loÿtiÚIndex
[
i
]] ++;

634 
m¬ked
[
i
] = 
çl£
;

637 
i
=0; i<
sûÇrio
->
	`g‘NumLoÿtiÚs
(); i++) {

638 
numOb£rv©iÚsAt
[
i
] > 
lim™
) {

639 
pos
;

640 
k
 = 
	`¿nd
(è% 
numOb£rv©iÚsAt
[
i
];

641 
pos
 = 
fœ¡Ob£rv©iÚAt
[
i
];

642 (
k
>0è|| (
m¬ked
[
pos
])) {

643 
pos
 = 
ÃxtRecÜd
[pos];

644 
	`as£¹
(
pos
>=0);

645 ià(!
m¬ked
[
pos
])

646 
k
--;

648 
	`as£¹
(
loÿtiÚIndex
[
pos
] =ğ
i
);

649 
m¬ked
[
pos
] = 
Œue
;

650 
numOb£rv©iÚsAt
[
i
] --;

654 
pos
 = 0;

655 
i
=0; i<
numOb£rv©iÚs
; i++) {

656 ià(!
m¬ked
[
i
]) {

657 
loÿtiÚIndex
[
pos
] =†oÿtiÚIndex[
i
];

658 
ob£rv©iÚ
[
pos
] = ob£rv©iÚ[
i
];

659 
pos
 ++;

663 
	`as£¹
(
pos
 <ğ(
lim™
 * 
sûÇrio
->
	`g‘NumLoÿtiÚs
()));

664 
numOb£rv©iÚs
 = 
pos
;

666 
	`ä“
(
m¬ked
);

667 
	`ä“
(
ÃxtRecÜd
);

668 
	}
}

670 
	gŒaššgD©aPackage
::
	$»moveAP
(
­Index
)

672 
i
=0; i<
numOb£rv©iÚs
; i++)

673 
ob£rv©iÚ
[
i
].
	`»moveAP
(
­Index
);

675 
sûÇrio
->
	`»moveAP
(
­Index
);

676 
	}
}

	@src/localize.cc

49 
	#_BSD_SOURCE


	)

50 
	~<uni¡d.h
>

51 
	~<¡dio.h
>

52 
	~<¡dlib.h
>

53 
	~<¬·/š‘.h
>

54 
	~<sys/ioùl.h
>

55 
	~<sys/time.h
>

56 
	~<sys/sock‘.h
>

57 
	~<lšux/wœ–ess.h
>

58 
	~<”ºo.h
>

59 
	~<¡ršg.h
>

60 
	~<time.h
>

61 
	~"ev®.h
"

78 
	#d´štf
(
a
...)

	)

80 
	#HISTORY
 3

	)

81 
	#USE_HIDDEN_MARKOV


	)

82 
	#USE_MASKING


	)

84 
	#MAX_PLACES
 300

	)

85 
	#MAX_MARKERS
 600

	)

86 
	#MAX_PATHLEN
 200

	)

88 
	#CARD
 0

	)

91 cÚ¡ *
	mÇme
;

92 cÚ¡ *
	mdeviû
;

93 
	moff£t
;

94 
	mçùÜ
;

95 } 
	tÿrdInfo
;

97 
ÿrdInfo
 
	gÿrd
[] = {

103 
	maùive
;

104 
	mkey
;

105 
	mxPos
, 
	myPos
, 
	mzPos
;

106 
	mty³
;

107 
	mcŞÜ
;

108 } 
	tm¬k”RecÜd
;

110 
m¬k”RecÜd
 
	gm¬k”
[
MAX_MARKERS
];

111 
ob£rv©iÚRecÜd
 
	gİ©h
[
MAX_PATHLEN
];

112 
	gŞocidx
[
MAX_PATHLEN
];

113 
	gcommªdPe
 = 0, 
	g·thËn
 = 0, 
	g·thidx
 = 0;

115 
	gsÿnSeq
 = 0;

117 
	$·r£Ev’ts
(*
­b
, 
Ën
, 
sûÇrioDesütÜ
 *
sûÇrio
, 
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
)

119 
iw_ev’t
 *
cu¼’tEv’t
 = (iw_ev’t*)
­b
;

120 
bufãr
[200], 
essid
[50];

121 
­idx
 = -1;

122 
i
;

128 
ob£rv©iÚ
->
	`z”o
();

130 
Ën
>0) {

131 
	`d´štf
("%4X %d by‹ (%d†eá)\n", 
cu¼’tEv’t
->
cmd
, cu¼’tEv’t->
Ën
,†en);

132 
cu¼’tEv’t
->
cmd
) {

133 
SIOCGIWAP
:

134 
	`¥rštf
(
bufãr
, "%2x:%2x:%2x:%2x:%2x:%2x\n",

135 ()
cu¼’tEv’t
->
u
.
­_addr
.
§_d©a
[0],

136 ()
cu¼’tEv’t
->
u
.
­_addr
.
§_d©a
[1],

137 ()
cu¼’tEv’t
->
u
.
­_addr
.
§_d©a
[2],

138 ()
cu¼’tEv’t
->
u
.
­_addr
.
§_d©a
[3],

139 ()
cu¼’tEv’t
->
u
.
­_addr
.
§_d©a
[4],

140 ()
cu¼’tEv’t
->
u
.
­_addr
.
§_d©a
[5]

142 
	`d´štf
(" MAC %s", 
bufãr
);

143 
­idx
 = 
sûÇrio
->
	`g‘ApIndex
(
bufãr
);

145 
SIOCGIWESSID
:

146 
	`d´štf
(" ESSID %s\n", ((*)(&
cu¼’tEv’t
->
u
)+8));

147 
i
=0; i<32; i++)

148 
essid
[
i
] = *((*)(&
cu¼’tEv’t
->
u
)+8+i);

149 
essid
[32] = 0;

151 
IWEVQUAL
:

152 ià(
­idx
 < 0) {

153 
	`´štf
("IgnÜšg unknowÀAP % (ESSID %s)\n", 
bufãr
, 
essid
);

154 } ià(
ob£rv©iÚ
->
sœ
[
­idx
]>0) {

155 
	`´štf
("Du¶iÿ‹ ob£rv©iÚ fÜ AP % (ESSID %s)", 
bufãr
, 
essid
);

157 
ob£rv©iÚ
->
sœ
[
­idx
] = 
cu¼’tEv’t
->
u
.
qu®
.
Ëv–
;

158 
ob£rv©iÚ
->
¢r
[
­idx
] = 
cu¼’tEv’t
->
u
.
qu®
.
noi£
;

163 
Ën
 -ğ
cu¼’tEv’t
->len;

164 
cu¼’tEv’t
 = (
iw_ev’t
*)(((*)cu¼’tEv’tè+ cu¼’tEv’t->
Ën
);

166 
	}
}

168 
	$sÿnFÜStiÚs
(*
bufãr
, 
maxËn
)

170 
sd
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

171 ià(
sd
<0) {

172 
	`´štf
("Cannot open socket\n");

173 
	`ex™
(1);

176 
iw»q
 
wrq
;

177 
»t
;

181 
	`mem£t
(
bufãr
, 0, 
maxËn
);

182 
	`¡ºıy
(
wrq
.
iä_Çme
, 
ÿrd
[
CARD
].
deviû
, 
IFNAMSIZ
);

183 
wrq
.
u
.
d©a
.
poš‹r
 = (
ÿddr_t
)
bufãr
;

184 
wrq
.
u
.
d©a
.
Ëngth
 = 0;

185 
wrq
.
u
.
d©a
.
æags
 = 0;

186 ià(
	`ioùl
(
sd
, 
SIOCSIWSCAN
, &
wrq
) < 0) {

187 
	`´štf
("IOCTL SIOCSIWSCAN faed: %dƒ¼no=%d\n", 
»t
, 
”ºo
);

188 
	`ex™
(1);

190 
	`d´štf
("R‘uºed %d by‹s\n", 
wrq
.
u
.
d©a
.
Ëngth
);

195 
wrq
.
u
.
d©a
.
poš‹r
 = (
ÿddr_t
)
bufãr
;

196 
wrq
.
u
.
d©a
.
Ëngth
 = 
maxËn
;

197 
wrq
.
u
.
d©a
.
æags
 = 0;

198 
»t
 = 
	`ioùl
(
sd
, 
SIOCGIWSCAN
, &
wrq
);

199 } (
»t
<0è&& (
”ºo
==
EAGAIN
));

201 ià(
»t
 < 0) {

202 
	`´štf
("IOCTL SIOCGIWSCAN faed: %dƒ¼no=%d\n", 
»t
, 
”ºo
);

203 
	`ex™
(1);

206 
	`d´štf
("R‘uºed %d by‹s\n", 
wrq
.
u
.
d©a
.
Ëngth
);

207 
	`şo£
(
sd
);

209  
wrq
.
u
.
d©a
.
Ëngth
;

210 
	}
}

212 
	$sÿn
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
sûÇrioDesütÜ
 *
sûÇrio
)

214 
bufãr
[4096];

215 
Ën
;

217 
ob£rv©iÚ
->
	`z”o
();

218 
Ën
 = 
	`sÿnFÜStiÚs
(
bufãr
, (buffer));

219 
	`·r£Ev’ts
(
bufãr
, 
Ën
, 
sûÇrio
, 
ob£rv©iÚ
);

220 
	}
}

222 
	$äÚ‹ndIn™
()

224 
pid_t
 
äÚ‹ndPid
;

225 
cPe
[2], 
dPe
[2];

227 
	`pe
(
cPe
);

228 
	`pe
(
dPe
);

232 ià((
äÚ‹ndPid
 = 
	`fÜk
())==0) {

233 
	`şo£
(
cPe
[1]);

234 
	`şo£
(
dPe
[0]);

235 
	`şo£
(
STDIN_FILENO
);

236 
	`şo£
(
STDOUT_FILENO
);

237 
	`dup2
(
cPe
[0], 
STDIN_FILENO
);

238 
	`dup2
(
dPe
[1], 
STDOUT_FILENO
);

240 cÚ¡ *
javahome
 = 
	`g‘’v
("JAVA_HOME");

241 ià(!
javahome
)

242 
	`·nic
("Please setƒnvironment variable JAVA_HOME!\n");

244 
bšÇme
[200];

245 
	`¡rıy
(
bšÇme
, "/usr/bin/java");

246 
	`exeş
(
bšÇme
, bšÇme, "-şas¥©h", "äÚ‹nd", "Snoİ”CÚŒŞ", 
NULL
);

247 
	`årštf
(
¡d”r
, "exeøçed: %d\n", 
”ºo
);

248 
	`ex™
(1);

251 
	`şo£
(
cPe
[0]);

252 
	`şo£
(
dPe
[1]);

254 
commªdPe
 = 
cPe
[1];

255 
	`şo£
(
STDIN_FILENO
);

256 
	`dup2
(
dPe
[0], 
STDIN_FILENO
);

257 
	}
}

259 
	$äÚ‹ndCmd
(cÚ¡ *
cmd
)

261 ià(!
commªdPe
)

264 
	`wr™e
(
commªdPe
, 
cmd
, 
	`¡¾’
(cmd));

265 
	`wr™e
(
commªdPe
, "\n", 1);

266 
	}
}

268 
	$mod–In™
()

270 
i
=0; i<
MAX_MARKERS
; i++)

271 
m¬k”
[
i
].
aùive
 = 0;

272 
	}
}

274 
	$mod–Red¿w
(
_m­No
)

276 *
ty³Name
[] = { "crosshairs", "box", "redbox", "yellowbox", "greenbox" };

277 
numM¬k”s
 = 0;

278 
sbuf
[200];

280 
	`äÚ‹ndCmd
("deleteAllMarkers()");

281 
	`¥rštf
(
sbuf
, "showImage(æoÜ%d.gif)", 
_m­No
);

282 
	`äÚ‹ndCmd
(
sbuf
);

284 
i
=0; i<
MAX_MARKERS
; i++) {

285 ià((
m¬k”
[
i
].
aùive
è&& (m¬k”[i].
zPos
 =ğ
_m­No
)) {

286 ià(
m¬k”
[
i
].
ty³
>4) {

287 
	`´štf
("Type>1\n");

288 
	`ex™
(1);

291 
	`¥rštf
(
sbuf
, "createMarker(%d,%s%d,%d,%d)",

292 
numM¬k”s
++, 
ty³Name
[
m¬k”
[
i
].
ty³
],

293 
m¬k”
[
i
].
cŞÜ
,

294 
m¬k”
[
i
].
xPos
, m¬k”[i].
yPos


296 
	`äÚ‹ndCmd
(
sbuf
);

300 
	`äÚ‹ndCmd
("redraw()");

301 
	}
}

303 
	$mod–Upd©e
(
key
, 
ty³
, 
xPos
, 
yPos
, 
zPos
, 
cŞÜ
, 
_m­No
)

305 
¡¬tPos
 = 
key
 % 
MAX_MARKERS
;

306 
foundPos
 = -1, 
em±yPos
 = -1;

308 
i
=0; i<
MAX_MARKERS
; i++) {

309 
pos
 = (
¡¬tPos
+
i
)%
MAX_MARKERS
;

310 ià(!
m¬k”
[
pos
].
aùive
 && (
em±yPos
 == -1))

311 
em±yPos
 = 
pos
;

312 ià(
m¬k”
[
pos
].
aùive
 && (m¬k”[pos].
key
 == key))

313 
foundPos
 = 
pos
;

316 ià((
foundPos
 =ğ-1è&& (
em±yPos
 == -1)) {

317 
	`´štf
("Too many markers\n");

318 
	`ex™
(1);

321 ià(
foundPos
 == -1)

322 
foundPos
 = 
em±yPos
;

324 
ÃedsRed¿w
 = 0;

325 ià((
m¬k”
[
foundPos
].
aùive
 && (m¬k”[foundPos].
zPos
 =ğ
_m­No
)) || (zPos == _mapNo))

326 
ÃedsRed¿w
 = 1;

328 
m¬k”
[
foundPos
].
aùive
 = 1;

329 
m¬k”
[
foundPos
].
key
 = key;

330 
m¬k”
[
foundPos
].
xPos
 = xPos;

331 
m¬k”
[
foundPos
].
yPos
 = yPos;

332 
m¬k”
[
foundPos
].
zPos
 = zPos;

333 
m¬k”
[
foundPos
].
ty³
 =ype;

334 
m¬k”
[
foundPos
].
cŞÜ
 = color;

336 ià(
ÃedsRed¿w
)

337 
	`mod–Red¿w
(
_m­No
);

338 
	}
}

340 
	$loÿlize_maš
(
ŒaššgD©aPackage
 *
d©a
, 
FILE
 *
šput
, FILE *
ouut
) {

342 
gbuf
[200], 
pbuf
[200];

343 
lšebuf
[256];

344 
ob£rv©iÚRecÜd
 
o
;

345 
loÿtiÚRecÜd
 *
P»ci£LoÿtiÚ
;

346 
loÿtiÚRecÜd
 *
Gues£dLoÿtiÚ
;

347 
”rÜDi¡ªû_m‘”s
;

349 
	`´štf
("befÜGMMLoÿliz”\n"); 
	`fæush
(
¡dout
);

352 
GMMLoÿliz”
 *
loÿliz”
 = 
Ãw
 
	`GMMLoÿliz”
(
d©a
);

354 
	`´štf
("aá” GMMLoÿliz”\n"); 
	`fæush
(
¡dout
);

357 
loÿliz”
->
	`Ex³ù©iÚMaximiz©iÚ
(
d©a
);

359 
	`´štf
("aá” EM\n"); 
	`fæush
(
¡dout
);

362 
´obab™yVeùÜ
 *
v
 = 
Ãw
 
	`´obab™yVeùÜ
();

364 
	`fg‘s
(
lšebuf
, Öšebuf)-1, 
šput
);

365 
tÙ®_numOb£rv©iÚs
 = 
	`©oi
(
lšebuf
);

367 
k
 = 0; k < 
tÙ®_numOb£rv©iÚs
; k++) {

368 
o
.
	`z”o
();

369 
	`mem£t
(
lšebuf
, 0, (linebuf));

371 
	`fg‘s
(
lšebuf
, Öšebuf)-1, 
šput
);

373 iàĞ
k
 < 
d©a
->
numOb£rv©iÚs
)

376 *
s
 = 
	`¡¹ok
(
lšebuf
, " ");

377 
­Index
 = 0;

379 
cu¼’tP»ci£LoÿtiÚ
 = 
	`©oi
(
s
);

380 
P»ci£LoÿtiÚ
 = 
d©a
->
sûÇrio
->
	`g‘LoÿtiÚ
(
cu¼’tP»ci£LoÿtiÚ
);

382 
s
 = 
	`¡¹ok
(
NULL
, " ");

383 
s
) {

384 
o
.
sœ
[
­Index
] = 
	`©oi
(
s
);

385 
­Index
 ++;

386 
s
 = 
	`¡¹ok
(
NULL
, " ");

388 
o
.
	`dump
();

391 
v
->
	`£tRªge
(0, 
NUM_LOCATIONS
 - 1, 0.0);

392 
cu¼’tGues£dLoÿtiÚ
 = -1;

395 
	`´štf
("\n*** Perform Localization***\n");

396 
	`´štf
("lozalizer\n");

397 
loÿliz”
->
	`loÿlize
(&
o
, 
v
);

400 
i
 = 0; i < 
NUM_LOCATIONS
 ; i++) {

401 
	`mem£t
(
gbuf
, 0, (gbuf));

402 
	`´štf
("\n%20  ", 
d©a
->
sûÇrio
->
	`g‘LoÿtiÚ
(
i
)->
	`»nd”
(
gbuf
));

403 
cout
<< 
v
->
pLoÿtiÚ
[
i
];

407 
cu¼’tGues£dLoÿtiÚ
 = 
v
->
	`be¡LoÿtiÚIndex
();

408 
Gues£dLoÿtiÚ
 = 
d©a
->
sûÇrio
->
	`g‘LoÿtiÚ
(
cu¼’tGues£dLoÿtiÚ
);

412 
”rÜDi¡ªû_m‘”s
 = ()((
Gues£dLoÿtiÚ
->
	`di¡ªûTo
(
P»ci£LoÿtiÚ
) / 14.51 ) + 0.5);

414 
	`mem£t
(
gbuf
, 0, (gbuf));

415 
	`mem£t
(
pbuf
, 0, (pbuf));

417 
	`´štf
("\n\n=== GMM LOCATION : %s CORRECT LOCATION : %s ErrorDistance(meters)=%d\n",

418 
Gues£dLoÿtiÚ
->
	`»nd”
(
gbuf
), 
P»ci£LoÿtiÚ
->»nd”(
pbuf
), 
”rÜDi¡ªû_m‘”s
);

420 
	`årštf
(
ouut
, "%d \n", 
”rÜDi¡ªû_m‘”s
);

422 
	`´štf
("\ÀDONE !!\n"); 
	`fæush
(
¡dout
);

424 
	}
}

426 
	$maš
(
¬gc
, *
¬gv
[]) {

428 ià(
¬gc
 != 6) {

429 
	`´štf
("Usage:†ocalize <placeFile> <apFile> <#†earn samples> <EM_file> <output-file>\n\n");

430 
	`ex™
(1);

433 
FILE
 *
šput
, *
ouut
;

435 
šput
 = 
	`fİ’
(
¬gv
[4], "r");

436 ià(!
šput
) {

437 
	`´štf
 ("Error„eading input file\n");

438 
	`ex™
(1);

441 
ouut
 = 
	`fİ’
 ( 
¬gv
[5], "a+");

442 ià(!
ouut
) {

443 
	`´štf
 ("Error inhe output file\n");

444 
	`ex™
(1);

447 
ŒaššgD©aPackage
 *
d©a
 = 
Ãw
 
	`ŒaššgD©aPackage
(
¬gv
[1],‡rgv[2]);

448 
	`´štf
("----------1-----------\n");

449 
d©a
->
sûÇrio
->
	`lock
();

450 
d©a
->
	`»adOb£rv©iÚsFrom
(
¬gv
[4], 
	`©oi
(argv[3]));

451 
	`´štf
("----------2-----------\n");

452 
	`´štf
("%d sÿn lßded\n", 
d©a
->
numOb£rv©iÚs
); 
	`fæush
(
¡dout
);

453 
d©a
->
sûÇrio
->
	`lock
();

455 
	`loÿlize_maš
(
d©a
, 
šput
, 
ouut
);

457 
	`fşo£
(
šput
);

458 
	`fşo£
(
ouut
);

461 
	}
}

	@src/localize_orig.cc

49 
	#_BSD_SOURCE


	)

50 
	~<uni¡d.h
>

51 
	~<¡dio.h
>

52 
	~<¡dlib.h
>

53 
	~<¬·/š‘.h
>

54 
	~<sys/ioùl.h
>

55 
	~<sys/time.h
>

56 
	~<sys/sock‘.h
>

57 
	~<lšux/wœ–ess.h
>

58 
	~<”ºo.h
>

59 
	~<¡ršg.h
>

60 
	~<time.h
>

61 
	~"ev®.h
"

78 
	#d´štf
(
a
...)

	)

80 
	#HISTORY
 3

	)

81 
	#USE_HIDDEN_MARKOV


	)

82 
	#USE_MASKING


	)

84 
	#MAX_PLACES
 300

	)

85 
	#MAX_MARKERS
 600

	)

86 
	#MAX_PATHLEN
 200

	)

88 
	#CARD
 0

	)

91 cÚ¡ *
	mÇme
;

92 cÚ¡ *
	mdeviû
;

93 
	moff£t
;

94 
	mçùÜ
;

95 } 
	tÿrdInfo
;

97 
ÿrdInfo
 
	gÿrd
[] = {

103 
	maùive
;

104 
	mkey
;

105 
	mxPos
, 
	myPos
, 
	mzPos
;

106 
	mty³
;

107 
	mcŞÜ
;

108 } 
	tm¬k”RecÜd
;

110 
m¬k”RecÜd
 
	gm¬k”
[
MAX_MARKERS
];

111 
ob£rv©iÚRecÜd
 
	gİ©h
[
MAX_PATHLEN
];

112 
	gŞocidx
[
MAX_PATHLEN
];

113 
	gcommªdPe
 = 0, 
	g·thËn
 = 0, 
	g·thidx
 = 0;

115 
	gsÿnSeq
 = 0;

117 
	$·r£Ev’ts
(*
­b
, 
Ën
, 
sûÇrioDesütÜ
 *
sûÇrio
, 
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
)

119 
iw_ev’t
 *
cu¼’tEv’t
 = (iw_ev’t*)
­b
;

120 
bufãr
[200], 
essid
[50];

121 
­idx
 = -1;

122 
i
;

128 
ob£rv©iÚ
->
	`z”o
();

130 
Ën
>0) {

131 
	`d´štf
("%4X %d by‹ (%d†eá)\n", 
cu¼’tEv’t
->
cmd
, cu¼’tEv’t->
Ën
,†en);

132 
cu¼’tEv’t
->
cmd
) {

133 
SIOCGIWAP
:

134 
	`¥rštf
(
bufãr
, "%2x:%2x:%2x:%2x:%2x:%2x\n",

135 ()
cu¼’tEv’t
->
u
.
­_addr
.
§_d©a
[0],

136 ()
cu¼’tEv’t
->
u
.
­_addr
.
§_d©a
[1],

137 ()
cu¼’tEv’t
->
u
.
­_addr
.
§_d©a
[2],

138 ()
cu¼’tEv’t
->
u
.
­_addr
.
§_d©a
[3],

139 ()
cu¼’tEv’t
->
u
.
­_addr
.
§_d©a
[4],

140 ()
cu¼’tEv’t
->
u
.
­_addr
.
§_d©a
[5]

142 
	`d´štf
(" MAC %s", 
bufãr
);

143 
­idx
 = 
sûÇrio
->
	`g‘ApIndex
(
bufãr
);

145 
SIOCGIWESSID
:

146 
	`d´štf
(" ESSID %s\n", ((*)(&
cu¼’tEv’t
->
u
)+8));

147 
i
=0; i<32; i++)

148 
essid
[
i
] = *((*)(&
cu¼’tEv’t
->
u
)+8+i);

149 
essid
[32] = 0;

151 
IWEVQUAL
:

152 ià(
­idx
 < 0) {

153 
	`´štf
("IgnÜšg unknowÀAP % (ESSID %s)\n", 
bufãr
, 
essid
);

154 } ià(
ob£rv©iÚ
->
sœ
[
­idx
]>0) {

155 
	`´štf
("Du¶iÿ‹ ob£rv©iÚ fÜ AP % (ESSID %s)", 
bufãr
, 
essid
);

157 
ob£rv©iÚ
->
sœ
[
­idx
] = 
cu¼’tEv’t
->
u
.
qu®
.
Ëv–
;

158 
ob£rv©iÚ
->
¢r
[
­idx
] = 
cu¼’tEv’t
->
u
.
qu®
.
noi£
;

163 
Ën
 -ğ
cu¼’tEv’t
->len;

164 
cu¼’tEv’t
 = (
iw_ev’t
*)(((*)cu¼’tEv’tè+ cu¼’tEv’t->
Ën
);

166 
	}
}

168 
	$sÿnFÜStiÚs
(*
bufãr
, 
maxËn
)

170 
sd
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

171 ià(
sd
<0) {

172 
	`´štf
("Cannot open socket\n");

173 
	`ex™
(1);

176 
iw»q
 
wrq
;

177 
»t
;

181 
	`mem£t
(
bufãr
, 0, 
maxËn
);

182 
	`¡ºıy
(
wrq
.
iä_Çme
, 
ÿrd
[
CARD
].
deviû
, 
IFNAMSIZ
);

183 
wrq
.
u
.
d©a
.
poš‹r
 = (
ÿddr_t
)
bufãr
;

184 
wrq
.
u
.
d©a
.
Ëngth
 = 0;

185 
wrq
.
u
.
d©a
.
æags
 = 0;

186 ià(
	`ioùl
(
sd
, 
SIOCSIWSCAN
, &
wrq
) < 0) {

187 
	`´štf
("IOCTL SIOCSIWSCAN faed: %dƒ¼no=%d\n", 
»t
, 
”ºo
);

188 
	`ex™
(1);

190 
	`d´štf
("R‘uºed %d by‹s\n", 
wrq
.
u
.
d©a
.
Ëngth
);

195 
wrq
.
u
.
d©a
.
poš‹r
 = (
ÿddr_t
)
bufãr
;

196 
wrq
.
u
.
d©a
.
Ëngth
 = 
maxËn
;

197 
wrq
.
u
.
d©a
.
æags
 = 0;

198 
»t
 = 
	`ioùl
(
sd
, 
SIOCGIWSCAN
, &
wrq
);

199 } (
»t
<0è&& (
”ºo
==
EAGAIN
));

201 ià(
»t
 < 0) {

202 
	`´štf
("IOCTL SIOCGIWSCAN faed: %dƒ¼no=%d\n", 
»t
, 
”ºo
);

203 
	`ex™
(1);

206 
	`d´štf
("R‘uºed %d by‹s\n", 
wrq
.
u
.
d©a
.
Ëngth
);

207 
	`şo£
(
sd
);

209  
wrq
.
u
.
d©a
.
Ëngth
;

210 
	}
}

212 
	$sÿn
(
ob£rv©iÚRecÜd
 *
ob£rv©iÚ
, 
sûÇrioDesütÜ
 *
sûÇrio
)

214 
bufãr
[4096];

215 
Ën
;

217 
ob£rv©iÚ
->
	`z”o
();

218 
Ën
 = 
	`sÿnFÜStiÚs
(
bufãr
, (buffer));

219 
	`·r£Ev’ts
(
bufãr
, 
Ën
, 
sûÇrio
, 
ob£rv©iÚ
);

220 
	}
}

222 
	$äÚ‹ndIn™
()

224 
pid_t
 
äÚ‹ndPid
;

225 
cPe
[2], 
dPe
[2];

227 
	`pe
(
cPe
);

228 
	`pe
(
dPe
);

232 ià((
äÚ‹ndPid
 = 
	`fÜk
())==0) {

233 
	`şo£
(
cPe
[1]);

234 
	`şo£
(
dPe
[0]);

235 
	`şo£
(
STDIN_FILENO
);

236 
	`şo£
(
STDOUT_FILENO
);

237 
	`dup2
(
cPe
[0], 
STDIN_FILENO
);

238 
	`dup2
(
dPe
[1], 
STDOUT_FILENO
);

239 cÚ¡ *
javahome
 = 
	`g‘’v
("JAVA_HOME");

240 ià(!
javahome
)

241 
	`·nic
("Please setƒnvironment variable JAVA_HOME!\n");

242 
bšÇme
[200];

243 
	`¥rštf
(
bšÇme
, "%s/bš/java", 
javahome
);

244 
	`exeş
(
bšÇme
, bšÇme, "-şas¥©h", "äÚ‹nd", "Snoİ”CÚŒŞ", 
NULL
);

245 
	`årštf
(
¡d”r
, "exeøçed: %d\n", 
”ºo
);

246 
	`ex™
(1);

249 
	`şo£
(
cPe
[0]);

250 
	`şo£
(
dPe
[1]);

252 
commªdPe
 = 
cPe
[1];

253 
	`şo£
(
STDIN_FILENO
);

254 
	`dup2
(
dPe
[0], 
STDIN_FILENO
);

255 
	}
}

257 
	$äÚ‹ndCmd
(cÚ¡ *
cmd
)

259 ià(!
commªdPe
)

262 
	`wr™e
(
commªdPe
, 
cmd
, 
	`¡¾’
(cmd));

263 
	`wr™e
(
commªdPe
, "\n", 1);

264 
	}
}

266 
	$mod–In™
()

268 
i
=0; i<
MAX_MARKERS
; i++)

269 
m¬k”
[
i
].
aùive
 = 0;

270 
	}
}

272 
	$mod–Red¿w
(
_m­No
)

274 *
ty³Name
[] = { "crosshairs", "box", "redbox", "yellowbox", "greenbox" };

275 
numM¬k”s
 = 0;

276 
sbuf
[200];

278 
	`äÚ‹ndCmd
("deleteAllMarkers()");

279 
	`¥rštf
(
sbuf
, "showImage(æoÜ%d.gif)", 
_m­No
);

280 
	`äÚ‹ndCmd
(
sbuf
);

282 
i
=0; i<
MAX_MARKERS
; i++) {

283 ià((
m¬k”
[
i
].
aùive
è&& (m¬k”[i].
zPos
 =ğ
_m­No
)) {

284 ià(
m¬k”
[
i
].
ty³
>4) {

285 
	`´štf
("Type>1\n");

286 
	`ex™
(1);

289 
	`¥rštf
(
sbuf
, "createMarker(%d,%s%d,%d,%d)",

290 
numM¬k”s
++, 
ty³Name
[
m¬k”
[
i
].
ty³
],

291 
m¬k”
[
i
].
cŞÜ
,

292 
m¬k”
[
i
].
xPos
, m¬k”[i].
yPos


294 
	`äÚ‹ndCmd
(
sbuf
);

298 
	`äÚ‹ndCmd
("redraw()");

299 
	}
}

301 
	$mod–Upd©e
(
key
, 
ty³
, 
xPos
, 
yPos
, 
zPos
, 
cŞÜ
, 
_m­No
)

303 
¡¬tPos
 = 
key
 % 
MAX_MARKERS
;

304 
foundPos
 = -1, 
em±yPos
 = -1;

306 
i
=0; i<
MAX_MARKERS
; i++) {

307 
pos
 = (
¡¬tPos
+
i
)%
MAX_MARKERS
;

308 ià(!
m¬k”
[
pos
].
aùive
 && (
em±yPos
 == -1))

309 
em±yPos
 = 
pos
;

310 ià(
m¬k”
[
pos
].
aùive
 && (m¬k”[pos].
key
 == key))

311 
foundPos
 = 
pos
;

314 ià((
foundPos
 =ğ-1è&& (
em±yPos
 == -1)) {

315 
	`´štf
("Too many markers\n");

316 
	`ex™
(1);

319 ià(
foundPos
 == -1)

320 
foundPos
 = 
em±yPos
;

322 
ÃedsRed¿w
 = 0;

323 ià((
m¬k”
[
foundPos
].
aùive
 && (m¬k”[foundPos].
zPos
 =ğ
_m­No
)) || (zPos == _mapNo))

324 
ÃedsRed¿w
 = 1;

326 
m¬k”
[
foundPos
].
aùive
 = 1;

327 
m¬k”
[
foundPos
].
key
 = key;

328 
m¬k”
[
foundPos
].
xPos
 = xPos;

329 
m¬k”
[
foundPos
].
yPos
 = yPos;

330 
m¬k”
[
foundPos
].
zPos
 = zPos;

331 
m¬k”
[
foundPos
].
ty³
 =ype;

332 
m¬k”
[
foundPos
].
cŞÜ
 = color;

334 ià(
ÃedsRed¿w
)

335 
	`mod–Red¿w
(
_m­No
);

336 
	}
}

338 
	$loÿlize_maš
(
ŒaššgD©aPackage
 *
d©a
, 
Hidd’M¬kovMod–
 *
hmm
)

340 
buf
[200], 
buf2
[200];

341 
cu¼’tZ
 = -1;

342 
numSÿns
 = 0;

347 ià(
·thËn
 == 0) {

348 
	`äÚ‹ndIn™
();

349 
	`äÚ‹ndCmd
("setStatus(Location unknown)");

352 
·thidx
 = 0;

356 
MaximumLik–ihoodLoÿliz”
 *
loÿliz”
 = 
Ãw
 
	`MaximumLik–ihoodLoÿliz”
(
d©a
, 0);

357 
ob£rv©iÚRecÜd
 
o
[
HISTORY
];

358 
i
=0; i<
HISTORY
; i++)

359 
o
[
i
].
	`z”o
();

361 
´obab™yVeùÜ
 *
v
 = 
Ãw
 
	`´obab™yVeùÜ
();

362 
v
->
	`£tRªge
(0, 
d©a
->
sûÇrio
->
	`g‘NumLoÿtiÚs
()-1, 1.0);

364 
cu¼’tGues£dLoÿtiÚ
 = -1;

365 !
·thËn
 || (
·thidx
<pathlen)) {

366 
i
=
HISTORY
-1; i>0; i--)

367 
o
[
i
] = o[i-1];

372 
numSÿns
 ++;

373 ià(
·thËn
 == 0) {

374 
	`sÿn
(&
o
[0], 
d©a
->
sûÇrio
);

375 ià(
cu¼’tGues£dLoÿtiÚ
 != -1) {

376 #ifdeà
USE_MASKING


377 
i
=0; i<
d©a
->
sûÇrio
->
	`g‘NumAP
(); i++)

378 ià(!
loÿliz”
->
	`isGoodAP
(
cu¼’tGues£dLoÿtiÚ
, 
i
)) {

379 
o
[0].
sœ
[
i
] = 0;

380 
	`´štf
("Drİpšg AP %s\n", 
d©a
->
sûÇrio
->
	`g‘AP
(
i
)->
	`g‘BSSID
()->
	`»nd”
(
buf
));

385 
o
[0] = 
İ©h
[
·thidx
++];

386 
o
[0].
	`dump
();

391 #ià!
	`defšed
(
USE_HIDDEN_MARKOV
)

392 
v
->
	`£tRªge
(0, 
d©a
->
sûÇrio
->
	`g‘NumLoÿtiÚs
()-1, 1.0);

393 
i
=0; i<
HISTORY
; i++)

394 
loÿliz”
->
	`loÿlize
(&
o
[
i
], 
v
);

396 ià(
numSÿns
 > 5)

397 
hmm
->
	`upd©e
(
v
);

398 
loÿliz”
->
	`loÿlize
(&
o
[0], 
v
);

403 
i
=0; i<
d©a
->
sûÇrio
->
	`g‘NumLoÿtiÚs
()-1; i++) {

404 ià(
v
->
pLoÿtiÚ
[
i
] > 0.05) {

405 
	`´štf
(" - %.2à%s\n", 
v
->
pLoÿtiÚ
[
i
], 
d©a
->
sûÇrio
->
	`g‘LoÿtiÚ
(i)->
	`»nd”
(
buf
));

409 
cu¼’tGues£dLoÿtiÚ
 = 
v
->
	`be¡LoÿtiÚIndex
();

410 
loÿtiÚRecÜd
 *
loc
 = 
d©a
->
sûÇrio
->
	`g‘LoÿtiÚ
(
v
->
	`be¡LoÿtiÚIndex
());

411 
	`´štf
("==ğLOCATION %d: % (%.2f)\n", 
·thidx
, 
loc
->
	`»nd”
(
buf
), 
v
->
pLoÿtiÚ
[v->
	`be¡LoÿtiÚIndex
()]);

412 
	`´štf
("LoÿtiÚ: %s\n", 
loc
->
	`»nd”
(
buf
));

416 
	`¥rštf
(
buf
, "£tStus(%s)", 
loc
->
	`»nd”
(
buf2
));

417 
	`äÚ‹ndCmd
(
buf
);

418 ià(
loc
->
	`g‘Z
(è!ğ
cu¼’tZ
) {

419 
	`¥rštf
(
buf
, "showImage(äÚ‹nd/æoÜ%d.gif)", 
loc
->
	`g‘Z
());

420 
	`äÚ‹ndCmd
(
buf
);

421 
cu¼’tZ
 = 
loc
->
	`g‘Z
();

423 
	`äÚ‹ndCmd
("deleteAllMarkers()");

424 
	`¥rštf
(
buf
, "ü—‹M¬k”(0,üosshaœs0,%d,%d)", 
loc
->
	`g‘X
(),†oc->
	`g‘Y
());

425 
	`äÚ‹ndCmd
(
buf
);

426 
	`äÚ‹ndCmd
("redraw()");

428 
	}
}

430 
	$maš
(
¬gc
, *
¬gv
[])

432 ià(
¬gc
 < 5) {

433 
	`´štf
("Usage:†ocalize <placeFile> <neighbourFile> <apFile> <scanFileDir> [scans...]\n\n");

434 
	`ex™
(1);

437 
ŒaššgD©aPackage
 *
d©a
 = 
Ãw
 
	`ŒaššgD©aPackage
(
¬gv
[1],‡rgv[3]);

438 
d©a
->
sûÇrio
->
	`lock
();

439 
d©a
->
	`»adOb£rv©iÚsFrom
(
¬gv
[4]);

440 
	`´štf
("%d sÿn lßded\n", 
d©a
->
numOb£rv©iÚs
);

441 
d©a
->
sûÇrio
->
	`lock
();

442 
TİŞogyMod–
 *
tİo
 = 
Ãw
 
	`TİŞogyMod–
(
d©a
->
sûÇrio
, 
¬gv
[2]);

443 
Hidd’M¬kovMod–
 *
hmm
 = 
Ãw
 
	`Hidd’M¬kovMod–
(
tİo
);

445 
·thËn
 = 0;

446 ià(
¬gc
 > 5) {

447 
x
;

448 
i
=5; i<
¬gc
; i++) {

449 
d©a
->
	`»adFe
(
¬gv
[
i
], &
İ©h
[
·thËn
], &
Şocidx
[pathlen]);

450 
·thËn
++;

454 
	`´štf
("### begin†ocalization\n");

455 
	`loÿlize_maš
(
d©a
, 
hmm
);

458 
	}
}

	@src/postprocess.cc

49 
	~<¡dio.h
>

50 
	~<¡dlib.h
>

51 
	~<m©h.h
>

53 
	~"ev®.h
"

55 
boŞ
 
	gu£It
[
MAX_AP
];

63 
	$maš
(
¬gc
, *
¬gv
[])

65 
buf1
[256], 
buf2
[256];

69 ià(
¬gc
 != 6) {

70 
	`´štf
("Usage:…ostprocess <placeFile> <apFile> <DataSetDirectory> <mlOutFile> <compactOutfile>\n");

71 
	`ex™
(1);

74 
	`´štf
("\n***1***\n");

75 
	`fæush
(
¡dout
);

77 
ŒaššgD©aPackage
 *
d©a
 = 
Ãw
 
	`ŒaššgD©aPackage
(
¬gv
[1],‡rgv[2]);

79 
d©a
->
numOb£rv©iÚs
 = 
NUM_OBSERVATIONS
 ;

82  
k
 = 0; k < 
NUM_POSITIONS
; k++)

83  
i
 = 0; i < 
NUM_OBSERVATIONS
; i++)

84 
d©a
->
ob£rv©iÚ
[ 
k
 * 
NUM_OBSERVATIONS
 + 
i
].
locId
 =†ocId[k];

87  
i
 = 0; i < 
d©a
->
numOb£rv©iÚs
; i++ )

88 
d©a
->
ob£rv©iÚ
[
i
].
	`z”o
();

90 
d©a
->
sûÇrio
->
	`lock
();

92 
d©a
->
	`addT¿ššgDœeùÜy
(
¬gv
[3]);

96 
d©a
->
	`addDœeùÜy
(
¬gv
[3]);

98 
	`´štf
("\n***4***\n");

99 
	`fæush
(
¡dout
);

101 
d©a
->
	`wr™eOb£rv©iÚsTo
(
¬gv
[5]);

105 
	`´štf
("\n***5***\n");

106 
	`fæush
(
¡dout
);

108 
FILE
 *
f
 = 
	`fİ’
(
¬gv
[4], "w+");

109 ià(!
f
)

110 
	`·nic
("CªnÙ o³ÀfÜ wr™šg: %s", 
¬gv
[4]);

112 
locIndex
 = 0;†ocIndex < 
d©a
->
sûÇrio
->
	`g‘NumLoÿtiÚs
();†ocIndex ++) {

113 
max
 = 
d©a
->
	`numOb£rv©iÚsAtLoÿtiÚ
(
locIndex
);

114 ià(
max
 == 0)

117 
	`årštf
(
f
, "%s\n", 
d©a
->
sûÇrio
->
	`g‘LoÿtiÚ
(
locIndex
)->
	`»nd”
(
buf1
));

119 
­Index
 = 0;‡pIndex < 
d©a
->
sûÇrio
->
	`g‘NumAP
();‡pIndex ++) {

120 
hi¡o
[256];

121 
i
=0; i<256; i++)

122 
hi¡o
[
i
] = 0;

124 
i
=0; i<
d©a
->
numOb£rv©iÚs
; i++)

125 ià(
d©a
->
loÿtiÚIndex
[
i
] =ğ
locIndex
)

126 
hi¡o
[
d©a
->
ob£rv©iÚ
[
i
].
sœ
[
­Index
]] ++;

127 ià(
max
 =ğ
hi¡o
[0])

132 
av”age
 = 0;

133 
i
=1; i<256; i++)

134 
av”age
 +ğ
hi¡o
[
i
] * i;

135 
av”age
 /ğ(
max
 - 
hi¡o
[0]);

137 
u£It
[
­Index
] = (
max
 !ğ
hi¡o
[0]);

139 
sigmasqu¬e
 = 0;

140 
i
=1; i<256; i++)

141 
sigmasqu¬e
 +ğ
hi¡o
[
i
] * (˜- 
av”age
) * (i -‡verage);

142 
sigmasqu¬e
 /ğ(
max
 - 
hi¡o
[0]);

143 
sigma
 = 
	`sq¹
(
sigmasqu¬e
);

144 ià(
sigma
 < 0.1)

147 
phi¡o
[256];

148 
phi¡o
[0] = 0;

149 
i
=1; i<256; i++)

150 
phi¡o
[
i
] = (()
hi¡o
[i])/(
max
-histo[0]);

152 
nÜm®
[256];

153 
i
=0; i<256; i++)

154 
nÜm®
[
i
] = (1/(
sigma
*
	`sq¹
(2*3.1415926)))*(
	`exp
(-(i-
av”age
)*(i-av”age)/(2*
sigmasqu¬e
)));

156 
devŸtiÚ
 = 0;

157 
i
=1; i<256; i++)

158 
devŸtiÚ
 +ğ(
phi¡o
[
i
] - 
nÜm®
[i])*(phisto[i] -‚ormal[i]);

160 
	`årštf
(
f
, " - %s m=%6.2f s=%5.2f d=%.3f\n",

161 
d©a
->
sûÇrio
->
	`g‘AP
(
­Index
)->
	`g‘BSSID
()->
	`»nd”
(
buf1
),

162 
av”age
, 
sigma
, 
devŸtiÚ


167 
	`fşo£
(
f
);

170 
	}
}

	@
1
.
0
16
290
include/eval.h
librwl/accesspoint.cc
librwl/bayes.cc
librwl/bssid.cc
librwl/location.cc
librwl/markov.cc
librwl/mlhood.cc
librwl/observation.cc
librwl/pvector.cc
librwl/scenario.cc
librwl/stat.cc
librwl/topology.cc
librwl/training.cc
src/localize.cc
src/localize_orig.cc
src/postprocess.cc
